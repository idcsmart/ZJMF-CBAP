<link rel="stylesheet" href="/plugins/server/idcsmart_common/template/clientarea/css/common_product_detail.css">

<div class="template common_product_detail">
  <!-- 自己的东西 -->
  <div class="main-card">
    <div class="main-card-title">
      <img :src="`${baseUrl}/img/finance/back.png`" alt="" @click="back" class="back">
      <span class="title">{{host.name}}</span>
      <span class="tag" v-if="hostData?.status"
        :style="'color:'+status[hostData.status]?.color + ';background:' + status[hostData.status]?.bgColor">{{status[hostData.status].text}}
      </span>
      <span class="up-authorization" @click="handelUpLicense" v-loading="upgradeLoading"
        v-if="hostData?.status && hostData.status === 'Active'">升降级</span>
    </div>
    <!-- 备注 -->
    <div class="notes">
      <!-- 有备注 -->
      <span class="yes-notes" v-if="hostData.notes" @click="doEditNotes">
        <i class="el-icon-edit notes-icon"></i>
        <span class="notes-text">{{hostData.notes}}</span>
      </span>
      <!-- 无备注 -->
      <span class="no-notes" v-else @click="doEditNotes">
        {{lang.cloud_add_notes + ' +'}}
      </span>
    </div>
    <div class="finance-info">
      <div class="status-box">
        <p class="s-tit">{{lang.menu_3}}</p>
        <template>
          <!-- 财务信息 -->
          <p class="stop-info"
            v-if="(refundInfo?.status === 'Suspending' || refundInfo?.status === 'Suspend' || refundInfo?.status === 'Suspended') && refundInfo.type === 'Expire'">
            <span class="info">(
              产品于{{refundInfo.create_time | formateTime}}申请 到期停用 ，于{{host.due_time | formateTime}}自动删除
              )</span>
          </p>
          <p class="stop-info" v-if="refundInfo?.status === 'Reject'">
            <span class="info reject">
              （产品于{{refundInfo.create_time | formateTime}}申请 立即停用 失败，
              <el-tooltip class="item" :content="refundInfo.reject_reason" placement="top">
                <a href="javascript:;">查看原因</a>
              </el-tooltip>

              ）
            </span>
          </p>
        </template>
      </div>
      <div class="box">
        <div class="item">
          <span>订购时间：</span>
          <span>{{host.create_time | formateTime}}</span>
        </div>
        <div class="item">
          <span>订购金额：</span>
          <span>{{commonData.currency_prefix}}{{host.first_payment_amount}}{{commonData.currency_suffix}}</span>
          <span @click="applyCashback" class="common-cashback" v-if="isShowCashBtn">{{lang.apply_cashback}}</span>
        </div>
        <div class="item">
          <span>到期时间：</span>
          <span>{{host.due_time | formateTime}}</span>

        </div>
        <div class="item">
          <span>标识：</span>
          <span>{{hostData.name}}</span>
        </div>
        <div class="item">
          <span>续费金额：</span>
          <span>{{commonData.currency_prefix}}{{host.renew_amount}}{{commonData.currency_suffix}}/{{host.billing_cycle_name}}</span>
          <!-- 非tingyong -->

          <template v-if="host?.status==='Active'">
            {foreach $addons as $addon}
            {if ($addon.name=='IdcsmartRenew')}
            <span class="renew btn" @click="showRenew"
              v-if="(!refundInfo || refundInfo || (refundInfo && refundInfo.status=='Cancelled') || (refundInfo && refundInfo.status=='Reject')) && (host.billing_cycle !== 'onetime' && host.billing_cycle !== 'free')">{{lang.cloud_re_btn}}</span>
            <!--  <span class="renew btn" @click="showRenew" v-if="(!refundInfo || (refundInfo && refundInfo.status=='Cancelled') || (refundInfo && refundInfo.status=='Reject')) && (host.billing_cycle !== 'onetime' && host.billing_cycle !== 'free')">{{lang.cloud_re_btn}}</span> -->
            <span class="disabeld btn" v-else>{{lang.cloud_re_btn}}</span>
            {/if}
            {/foreach}
            {foreach $addons as $addon}
            {if ($addon.name=='IdcsmartRefund')}
            <span class="war btn"
              v-if="refundInfo && refundInfo.status != 'Cancelled' && refundInfo.status != 'Reject'">{{refundStatus[refundInfo.status]}}</span>
            <!-- <span class="war btn refund-stop-btn" v-if="refundInfo && refundInfo.status=='Pending'" @click="cancelRefund">取消停用</span> -->
            <span class="war btn refund-stop-btn"
              v-if="refundInfo && (refundInfo.status=='Pending' || refundInfo.status=='Suspend' || refundInfo.status=='Suspending')"
              @click="cancelRefund">取消停用</span>
            <span class="cancel btn" @click="stop_use"
              v-if="!refundInfo || (refundInfo && (refundInfo.status=='Reject')) || (refundInfo && (refundInfo.status=='Cancelled'))">停用</span>
            {/if}
            {/foreach}
          </template>

          <!-- <template v-if="refundInfo?.status !== 'Pending'">
                    <span class="renew btn" @click="showRenew">续费</span>
                    <span class="stop btn" @click="stop_use" v-if=" refundInfo.status === 'Reject' || refundInfo.status === 'Cancelled'">停用</span>
                  </template>
                  <template v-else>
                    <span class="disabeld btn" v-if="!refundInfo || (refundInfo && refundInfo.status=='Cancelled') || (refundInfo && refundInfo.status=='Reject')">续费</span>
                    <span class="war btn" v-if="refundInfo && refundInfo.status != 'Cancelled' && refundInfo.status != 'Reject'">{{refundInfo.status}}</span>
                    <span class="cancel btn" @click="cancelRefund" v-if="refundInfo && refundInfo.status=='Pending'">取消停用</span>
                  </template> -->
        </div>
        {foreach $addons as $addon}
        {if ($addon.name=='IdcsmartRenew')}
        <div class="item"
          v-if="host.billing_cycle !== 'onetime' && host.billing_cycle !== 'free' && host?.status === 'Active'">
          <span>自动续费：</span>
          <el-switch :value="isShowPayMsg" active-color="#0052D9" :active-value="1" :inactive-value="0"
            @change="changeAutoStatus">
          </el-switch>
          <el-popover placement="top" trigger="hover">
            <div class="sure-remind">
              开启自动续费后，即将到期时不再发送续费通知，而是检测余额是否充足，余额充足时将自动续费
            </div>
            <div class="help" slot="reference">?</div>
          </el-popover>
        </div>
        {/if}
        {/foreach}
        <div class="item">
          <span>优惠码：</span>
          <span v-if="promo_code.length > 0">
            <span v-for="(item,index) in promo_code" :key="item">{{item}}
              <span v-if="index !== 0">;</span>
            </span>
          </span>
          <span v-else>--</span>
        </div>
      </div>
    </div>
    <!-- 基础信息 -->
    <div class="basic-info">
      <p class="s-tit">基础信息</p>
      <div class="box">
        <div class="item" v-for="(item,index) in firstInfo" :key="index"
          :class="{'last_item': firstInfo.length % 2 !== 0 && index === firstInfo.length - 2}">

          <p @mouseenter="e=>checkWidth(e,index)" @mouseout="hideTip(index)" v-if="!item.show" class="name">
            {{item.option_name}}
          </p>
          <el-tooltip class="item" :content="item.option_name" placement="top" v-if="item.show">
            <p class="name">{{item.option_name}}</p>
          </el-tooltip>

          <div class="r-info">
            <span class="s-item" v-if="item.option_type === 'quantity' || item.option_type === 'quantity_range'">
              {{item.qty}}
            </span>
            <span class="s-item" v-for="(el,ind) in item.subs" :key="ind">
              <img :src="`/upload/common/country/${el.country}.png`" alt="" v-if="item.option_type ==='area'">
              <template v-if="item.option_type ==='area'">
                {{calcCountry(el.country)}}&nbsp;-
              </template>
              {{el.option_name}}
            </span>
            <span>{{item.unit}}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- 续费弹窗 -->
    <div class="renew-dialog">
      <el-dialog width="6.9rem" :visible.sync="isShowRenew" :show-close=false @close="renewDgClose">
        <div class="dialog-title">续费</div>
        <div class="dialog-main">
          <div class="renew-content">
            <div class="renew-item" v-for="(item,index) in renewPageData" :key="index"
              :class="renewActiveId == index ? 'renew-active' : ''" @click="renewItemChange(item,index)">
              <div class="item-top">{{item.billing_cycle}}</div>
              <div class="item-bottom" v-if="isShowPromo && isUseDiscountCode">{{commonData.currency_prefix +
                item.base_price}}</div>
              <div class="item-bottom" v-else>{{commonData.currency_prefix + item.price}}</div>
              <div class="item-origin-price" v-if="item.price != item.base_price && !isUseDiscountCode">
                {{commonData.currency_prefix + item.base_price}}</div>
              <i class="el-icon-check check" v-show="renewActiveId == index"></i>
            </div>
          </div>
        </div>
        <div class="pay-content">
          <div class="pay-price">
            <div class="money" v-loading="renewLoading">
              <span
                class="text">{{lang.common_cloud_label11}}:</span><span>{{commonData.currency_prefix}}{{renewParams.totalPrice
                | filterMoney}}</span>
              <el-popover placement="top-start" width="200" trigger="hover"
                v-if="isShowLevel || (isShowPromo && isUseDiscountCode) || isShowCash">
                <div class="show-config-list">
                  <p v-if="isShowLevel">{{lang.shoppingCar_tip_text2}}：{{commonData.currency_prefix}} {{
                    renewParams.clDiscount | filterMoney}}</p>
                  <p v-if="isShowPromo && isUseDiscountCode">
                    {{lang.shoppingCar_tip_text4}}：{{commonData.currency_prefix}} {{ renewParams.code_discount |
                    filterMoney }}</p>
                  <p v-if="isShowCash && customfield.voucher_get_id">代金券抵扣金额：{{commonData.currency_prefix}} {{
                    renewParams.cash_discount | filterMoney}}</p>
                </div>
                <i class="el-icon-warning-outline total-icon" slot="reference"></i>
              </el-popover>
              <p class="original-price"
                v-if="customfield.promo_code && renewParams.totalPrice != renewParams.base_price">
                {{commonData.currency_prefix}} {{ renewParams.base_price | filterMoney}}</p>
              <p class="original-price"
                v-if="!customfield.promo_code && renewParams.totalPrice != renewParams.original_price">
                {{commonData.currency_prefix}} {{ renewParams.original_price | filterMoney}}</p>
              <div class="code-box">
                <!-- 代金券 -->
                <cash-coupon ref="cashRef" v-show=" isShowCash && !cashObj.code"
                  :currency_prefix="commonData.currency_prefix" @use-cash="reUseCash" scene='renew'
                  :product_id="[product_id]" :price="renewParams.original_price"></cash-coupon>
                <!-- 优惠码 -->
                <discount-code v-show="isShowPromo && !customfield.promo_code" @get-discount="getDiscount(arguments)"
                  scene='renew' :product_id="product_id" :amount="renewParams.base_price"
                  :billing_cycle_time="renewParams.duration"></discount-code>
              </div>
              <div class="code-number-text">
                <div class="discount-codeNumber" v-show="customfield.promo_code">{{ customfield.promo_code }}<i
                    class="el-icon-circle-close remove-discountCode" @click="removeDiscountCode()"></i></div>
                <div class="cash-codeNumber" v-show="cashObj.code">{{ cashObj.code }}<i
                    class="el-icon-circle-close remove-discountCode" @click="reRemoveCashCode()"></i></div>
              </div>
            </div>
          </div>
        </div>
        <div class="dialog-footer">
          <el-button class="btn-ok" @click="subRenew" :loading="loading">确认续费</el-button>
          <div class="btn-no" @click="renewDgClose">取消</div>
        </div>
      </el-dialog>
    </div>

    <!-- 停用弹窗 -->
    <el-dialog :title="refundDialog.allow_refund == 1?'退款':'停用'" :visible.sync="refundVisible" class="refundDialog"
      :show-close="false">
      <el-form :model="refundForm" label-position="top">
        <p class="tit">产品信息</p>
        <div class="info">
          <div class="des">
            <div class="item">
              <p class="s-tit">产品配置：</p>
              <div class="config">
                <div class="s-item" v-for="(item,index) in configoptions" :key="index" style="display: flex;">
                  <p class="name">{{item.option_name}}：</p>
                  <div class="r-info">
                    <span class="s-item"
                      v-if="item.option_type === 'quantity' || item.option_type === 'quantity_range'">
                      {{item.qty}}
                    </span>
                    <span class="s-item" v-for="(el,ind) in item.subs" :key="ind">
                      <img :src="`/upload/common/country/${el.country}.png`" alt="" v-if="item.option_type ==='area'"
                        style="width: .2rem;">
                      {{el.option_name}}
                    </span>
                  </div>
                  <span>{{item.unit}}</span>
                </div>
              </div>
            </div>
            <div class="item">
              <p class="s-tit">订购时间: </p>
              <div class="config">
                {{refundDialog?.host?.create_time | formateTime}}
              </div>
            </div>
            <div class="item" v-if="refundDialog.allow_refund == 1">
              <p class="s-tit">订购金额: </p>
              <div class="config">
                {{commonData.currency_prefix}}{{refundDialog?.host?.first_payment_amount}}
              </div>
            </div>
          </div>
        </div>
        <el-form-item label="停用原因">
          <el-select v-model="refundForm.arr" v-if="!refundDialog.reason_custom" style="width: 100%;" multiple>
            <el-option :label="item.content" :value="item.id" v-for="item in refundDialog.reasons"
              :key="item.id"></el-option>
          </el-select>
          <el-input v-model="refundForm.str" v-else placeholder="请输入停用原因"></el-input>
        </el-form-item>
        <el-form-item label="停用时间">
          <el-select v-model="refundForm.type" @change="changeReson">
            <el-option label="到期后" value="Expire"></el-option>
            <el-option label="立即" value="Immediate"></el-option>
          </el-select>
        </el-form-item>
      </el-form>
      <p class="tit" v-if="refundDialog.allow_refund == 1">退款金额</p>
      <p class="money" v-if="refundDialog.allow_refund == 1">{{commonData.currency_prefix}}{{refundMoney}}</p>
      <div slot="footer" class="dialog-footer">
        <el-button type="primary" @click="submitRefund" :loading="loading">{{refundDialog.allow_refund ==
          1?'确认退款':'确认停用'}}</el-button>
        <el-button @click="refundVisible = false">取消</el-button>
      </div>
    </el-dialog>

    <!-- 不允许退款 -->

    <el-dialog title="" :visible.sync="noRefundVisible" class="no-allow" :show-close="false">
      <img :src="`${baseUrl}/img/common/close.png`" alt="">
      <span class="tit">退款失败!</span>
      <span class="des">非常抱歉，给您带来不便，该产品不支持退款，<br />若有疑问，请联系售后人员！</span>
      <span slot="footer" class="dialog-footer">
        <el-button type="primary" @click="noRefundVisible = false">确认</el-button>
      </span>
    </el-dialog>

    <!-- 支付弹窗 -->
    <pay-dialog ref="payDialog" @payok="paySuccess" @paycancel="payCancel"></pay-dialog>
    <!-- 修改备注弹窗 -->
    <div class="notes-dialog">
      <el-dialog width="6.2rem" :visible.sync="isShowNotesDialog" :show-close=false @close="notesDgClose">
        <div class="dialog-title">
          {{hostData.notes?'修改备注':'添加备注'}}
        </div>
        <div class="dialog-main">
          <div class="label">备注</div>
          <el-input class="notes-input" v-model="notesValue"></el-input>
        </div>
        <div class="dialog-footer">
          <div class="btn-ok" @click="subNotes">提交</div>
          <div class="btn-no" @click="notesDgClose">取消</div>
        </div>
      </el-dialog>
    </div>

    <!-- 自动续费 -->
    <el-dialog :visible.sync="dialogVisible" width="6.2rem;" custom-class="autoDialog" :show-close="false">
      <span class="title">{{autoTitle}}</span>
      <div class="dialog-main">
        <div class="label">主机名</div>
        <div class="value">{{hostData.name}}</div>
      </div>
      <div slot="footer" class="dialog-footer">
        <div type="primary" @click="changeAuto" class="btn-ok">提交</div>
        <div @click="dialogVisible = false" class="btn-no">取消</div>
      </div>
    </el-dialog>

    <!-- 申请返现 -->
    <cash-back :id="id" :show-cash="isShowCashDialog" @cancledialog="cancleDialog" @showbtn="showBtn"></cash-back>

    <!-- 升降级弹窗 -->
    <el-dialog class="up-License" :visible.sync="upLicenseDialogShow" width="12rem" :show-close="false"
      :close-on-click-modal="false">
      <div class="license-title">升降级</div>
      <div class="license-box">
        <el-tabs v-model="licenseActive" @tab-click="handleTabClick">
          <el-tab-pane label="产品升降级" name="1" v-if="isShowUp">
            <div class="lincense-div">
              <div class="now-lincense">
                <div class="lincense-text">当前产品</div>
                <div class="lincense-content">
                  <div class="content-title">{{upgradeHost.name}}</div>
                  <div class="content-box">
                    <div class="content-item" v-for="(item,index) in upgradeConfig" :key="index + 'upgradeConfig'">
                      {{item.option_name}}
                      <span
                        v-if="item.option_type ==='quantity_range' || item.option_type ==='quantity'">{{item.qty}}</span>
                      <span v-else>{{item.sub_name}}</span>
                      {{item.unit}}
                    </div>
                    <div class="content-item" v-for="(item,index) in upgradeSon_host" :key="index + 'upgradeSon_host'">
                      售后服务
                      <span>已购买</span>
                    </div>
                  </div>
                </div>
              </div>
              <!-- 升级列表 -->
              <div class="can-upLincense">
                <div class="lincense-text">可升级产品</div>
                <div class="canUp-box">
                  <div class="canUp-content">
                    <div class="canUp-name" v-for="(item,index) in upgradeList" :key="index"
                      @click="selectUpItem(index)" :class="selectUpIndex === index ? 'select-content' : ''">
                      {{item.common_product?.name}}</div>
                  </div>
                  <div class="config-box">
                    <div class="l-config">
                      <!-- <div class="description" v-html="calStr" v-if="calStr"></div> -->
                      <!-- 自定义配置项 -->
                      <div class="config-item" v-for="(item,index) in configoptions" :key="index">
                        <p class="config-tit">{{item.option_name}}</p>
                        <!-- 配置项 -->
                        <div class="config-way">
                          <!-- 下拉单选/多选 -->
                          <el-select v-model="configForm[item.id]" :placeholder="lang.please_select"
                            v-if="item.option_type === 'select' || item.option_type ==='multi_select'"
                            :multiple="item.option_type ==='multi_select'" collapse-tags @change="changeItem(item)">
                            <el-option v-for="(item,index) in item.subs" :key="index" :label="item.option_name"
                              :value="item.id">
                            </el-option>
                          </el-select>
                          <!-- 是否 -->
                          <el-switch v-model="configForm[item.id]" v-if="item.option_type ==='yes_no'"
                            active-color="#0052D9" :active-value="calcSwitch(item,true)"
                            :inactive-value="calcSwitch(item,false)" @change="changeConfig(false)">
                          </el-switch>
                          <!-- 数据输入 -->
                          <el-input-number v-model.number="configForm[item.id]" :min="item.qty_min" :max="item.qty_max"
                            v-if="item.option_type ==='quantity'" @change="(val)=>fatherChange(val,item)">
                          </el-input-number>
                          <!-- 数量拖动 -->
                          <div class="slider" v-if="item.option_type ==='quantity_range'">
                            <span class="min">{{item.qty_min}}~</span>
                            <span class="max">{{item.qty_max}}</span>
                            <el-slider show-input :show-input-controls="false"
                              v-if="configForm[item.id] && configForm[item.id].length !==0"
                              v-model.number="configForm[item.id][0]" @change="(val)=>fatherChange(val,item)"
                              :min="item.qty_min" :max="item.qty_max" :step="item.subs[0]?.qty_change || 1">
                            </el-slider>
                          </div>
                          <!-- 点击单选 -->
                          <div class="click-select" v-if="item.option_type ==='radio'">
                            <div class="item" v-for="(el,index) in item.subs" :key="index"
                              :class="{'com-active': el.id === configForm[item.id]}" @click="changeClick(item.id, el)">
                              {{el.option_name}}
                              <i class="el-icon-check"></i>
                            </div>
                          </div>
                          <!-- 区域选择 -->
                          <div class="area-box" v-if="item.option_type ==='area'">
                            <p class="tit">{{lang.account_label4}}</p>
                            <div class="country">
                              <div class="item" v-for="(el,index) in filterCountry[item.id]" :key="index"
                                :class="{'com-active': index  === curCountry[item.id] }"
                                @click="changeCountry(item.id,index)">
                                <img :src="`upload/common/country/${el[0].country}.png`" alt="">
                                <span>{{calcCountry(el[0].country)}}</span>
                                <i class="el-icon-check"></i>
                              </div>
                            </div>
                            <p class="tit">{{lang.com_config.city}}</p>
                            <div class="city">
                              <div class="item" v-for="(el,index) in filterCountry[item.id][curCountry[item.id]]"
                                :key="index" :class="{'com-active': el.id  === configForm[item.id] }"
                                @click="changeCity(el, item.id)">
                                <img :src="`upload/common/country/${el.country}.png`" alt="">
                                <span>{{el.option_name}}</span>
                                <i class="el-icon-check"></i>
                              </div>
                            </div>
                          </div>
                          <!-- 后缀单位 -->
                          <span class="unit">{{item.unit}}</span>
                        </div>
                        <!-- 描述 -->
                        <!-- <p class="des" v-if="item.option_type !== 'area' && item.description" v-html="calcDes(item.description)"> -->
                        </p>
                      </div>
                      <!-- 周期 -->
                      <div class="config-item">
                        <p class="config-tit">{{lang.com_config.cycle}}</p>
                        <div class="onetime cycle" v-if="basicInfo.pay_type && basicInfo.pay_type === 'onetime'">
                          <div class="item com-active">
                            <p class="name">{{lang.common_cloud_text6}}</p>
                            <p class="price">{{commonData.currency_prefix}}{{onetime}}</p>
                            <i class="el-icon-check"></i>
                          </div>
                        </div>
                        <div class="onetime cycle" v-if="basicInfo.pay_type && basicInfo.pay_type === 'free'">
                          <div class="item com-active">
                            <p class="name">{{lang.product_free}}</p>
                            <p class="price">{{commonData.currency_prefix}}0.00</p>
                            <i class="el-icon-check"></i>
                          </div>
                        </div>
                        <div class="cycle"
                          v-if="basicInfo.pay_type && (basicInfo.pay_type === 'recurring_prepayment' || basicInfo.pay_type === 'recurring_postpaid')">
                          <div class="item" v-for="(item,index) in custom_cycles" :key="index"
                            @click="changeCycle(item,index)" :class="{'com-active': index === curCycle }">
                            <p class="name">{{item?.name}}</p>
                            <p class="price">{{commonData.currency_prefix}}{{((item.cycle_amount !== '' ?
                              item.cycle_amount : item.amount) * 1).toFixed(2) | filterMoney}}</p>
                            <i class="el-icon-check"></i>
                          </div>
                        </div>
                      </div>
                      <div class="sub-box">
                        <!-- 循环展示子商品 -->
                        <div class="sub-item" v-for="(sub,index) in upSon" :key="index">
                          <div class="pro-tit">{{basicInfo?.name}}-{{sub.basicInfo?.name}}</div>
                          <el-switch v-model="sub.open" class="sub-switch" active-color="#0052D9"
                            @change="changeSub"></el-switch>
                          <div v-show="sub.open">
                            <!-- <div class="description" v-html="calcDes(sub.basicInfo?.order_page_description)" v-if="sub.basicInfo?.order_page_description"></div> -->
                            <!-- 自定义配置项 -->
                            <div class="config-item" v-for="(item,index) in sub.configoptions" :key="index">
                              <p class="config-tit">{{item.option_name}}</p>
                              <!-- 配置项 -->
                              <div class="config-way">
                                <!-- 下拉单选/多选 -->
                                <el-select v-model="sonConfigForm[index][item.id]" :placeholder="lang.please_select"
                                  v-if="item.option_type === 'select' || item.option_type ==='multi_select'"
                                  :multiple="item.option_type ==='multi_select'" collapse-tags
                                  @change="changeItem(item)">
                                  <el-option v-for="(item,index) in item.subs" :key="index" :label="item.option_name"
                                    :value="item.id">
                                  </el-option>
                                </el-select>
                                <!-- 是否 -->
                                <el-switch v-model="sonConfigForm[index][item.id]" v-if="item.option_type ==='yes_no'"
                                  active-color="#0052D9" :active-value="calcSwitch(item,true)"
                                  :inactive-value="calcSwitch(item,false)" @change="changeConfig(false)">
                                </el-switch>
                                <!-- 数据输入 -->
                                <el-input-number :disabled="sub.basicInfo.configoption_id > 0"
                                  v-model.number="sonConfigForm[index][item.id]" :min="item.qty_min" :max="item.qty_max"
                                  v-if="item.option_type ==='quantity'" @change="changeConfig(false)">
                                </el-input-number>
                                <!-- 数量拖动 -->
                                <div class="slider" v-if="item.option_type ==='quantity_range'">
                                  <span class="min">{{item.qty_min}}~</span>
                                  <span class="max">{{item.qty_max}}</span>
                                  <el-slider show-input :show-input-controls="false"
                                    :disabled="sub.basicInfo.configoption_id > 0"
                                    v-if="sonConfigForm[index][item.id] && sonConfigForm[index][item.id].length !=0"
                                    v-model.number="sonConfigForm[index][item.id][0]"
                                    @change="(val)=>changeSonNum(val,item)" :min="item.qty_min" :max="item.qty_max"
                                    :step="item.subs[0]?.qty_change || 1">
                                  </el-slider>
                                </div>
                                <!-- 点击单选 -->
                                <div class="click-select" v-if="item.option_type ==='radio'">
                                  <div class="item" v-for="(el,index) in item.subs" :key="index"
                                    :class="{'com-active': el.id === sonConfigForm[index][item.id]}"
                                    @click="changeClick(item.id, el)">
                                    {{el.option_name}}
                                    <i class="el-icon-check"></i>
                                  </div>
                                </div>
                                <!-- 区域选择 -->
                                <div class="area-box" v-if="item.option_type ==='area'">
                                  <p class="tit">{{lang.account_label4}}</p>
                                  <div class="country">
                                    <div class="item" v-for="(el,aInd) in sonCountry[index][item.id]" :key="aInd"
                                      :class="{'com-active': aInd  === sonCurCountry[0][item.id *1] }"
                                      @click="changeSubCountry(item.id,index,aInd)">
                                      <img :src="`upload/common/country/${el[0].country}.png`" alt="">
                                      <span>{{calcCountry(el[0].country)}}</span>
                                      <i class="el-icon-check"></i>
                                    </div>
                                  </div>
                                  <p class="tit">{{lang.com_config.city}}</p>
                                  <div class="city">
                                    <div class="item"
                                      v-for="(el,aInd) in sonCountry[index][item.id][sonCurCountry[0][item.id]]"
                                      :key="aInd" :class="{'com-active': el.id  === sonConfigForm[index][item.id] }"
                                      @click="changeSubCity(el, item.id, index, aInd)">
                                      <img :src="`upload/common/country/${el.country}.png`" alt="">
                                      <span>{{el.option_name}}</span>
                                      <i class="el-icon-check"></i>
                                    </div>
                                  </div>
                                </div>
                                <!-- 后缀单位 -->
                                <span class="unit">{{item.unit}}</span>
                              </div>
                              <!-- 描述 -->
                              <!-- <p class="des" v-if="item.option_type !== 'area' && item.description" v-html="calcDes(item.description)"> -->
                              </p>
                            </div>
                            <!-- 周期 -->
                            <!-- 当父商品的付费类型为周期的时候，子商品的周期不可选择，与父商品同步 -->
                            <div class="config-item"
                              :class="{sync: basicInfo.pay_type === 'recurring_prepayment' || basicInfo.pay_type === 'recurring_postpaid'}">
                              <p class="config-tit">{{lang.com_config.cycle}} <span v-if="sub.basicInfo.free"
                                  style="font-size: .14rem;color: #999;">（首周期免费）</span></p>
                              <div class="onetime cycle" v-if="sub.basicInfo.pay_type === 'onetime'">
                                <!-- <p>{{lang.product_onetime_free}}：{{commonData.currency_prefix}}{{sub.onetime}}</p> -->
                                <div class="item com-active">
                                  <p class="name">{{lang.common_cloud_text6}}</p>
                                  <p class="price">{{commonData.currency_prefix}}{{sub.onetime}}</p>
                                  <i class="el-icon-check"></i>
                                </div>
                              </div>
                              <div class="onetime cycle" v-if="sub.basicInfo.pay_type === 'free'">
                                <!-- <p>{{lang.product_free}}</p> -->
                                <div class="item com-active">
                                  <p class="name">{{lang.product_free}}</p>
                                  <p class="price">{{commonData.currency_prefix}}0.00</p>
                                  <i class="el-icon-check"></i>
                                </div>
                              </div>
                              <div class="cycle"
                                v-if="sub.basicInfo.pay_type === 'recurring_prepayment' || sub.basicInfo.pay_type === 'recurring_postpaid'">
                                <div class="item" v-for="(item,ind) in sub.custom_cycles" :key="item.id"
                                  @click="changeSubCycle(item,ind,index)"
                                  :class="{'com-active': ind === sonCurCycle[index] }">
                                  <p class="name">{{item.name}}</p>
                                  <p class="price">{{commonData.currency_prefix}}{{((item.cycle_amount !== '' ?
                                    item.cycle_amount : item.amount) * 1).toFixed(2) | filterMoney}}</p>
                                  <i class="el-icon-check"></i>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </el-tab-pane>
          <el-tab-pane label="配置升降级" name="2">
            <div class="lincense-div">
              <div class="now-lincense">
                <div class="lincense-text">当前产品</div>
                <div class="lincense-content">
                  <div class="content-title">{{upgradeHost.name}}</div>
                  <div class="content-box">
                    <div class="content-item" v-for="(item,index) in upgradeConfig" :key="index + 'upgradeConfig'">
                      {{item.option_name}}
                      <span
                        v-if="item.option_type ==='quantity_range' || item.option_type ==='quantity'">{{item.qty}}</span>
                      <span v-else>{{item.sub_name}}</span>
                      {{item.unit}}
                    </div>
                    <div class="content-item" v-for="(item,index) in upgradeSon_host" :key="index + 'upgradeSon_host'">
                      售后服务
                      <span>已购买</span>
                    </div>
                  </div>
                </div>
              </div>
              <!-- 升级列表 -->
              <div class="can-upLincense">
                <div class="lincense-text">可升级配置</div>
                <div class="canUp-box">
                  <div class="canUp-content">
                    <div class="canUp-name select-content">变更升级配置</div>
                  </div>
                  <div class="config-box">
                    <div class="l-config">
                      <!-- <div class="description" v-html="calStr" v-if="calStr"></div> -->
                      <!-- 自定义配置项 -->
                      <div class="config-item" v-for="(item,index) in configoptions" :key="index">
                        <p class="config-tit">{{item.option_name}}</p>
                        <!-- 配置项 -->
                        <div class="config-way"
                          v-if="(item.son_product_id > 0 && isBuyServe) || item.son_product_id === 0">
                          <!-- 下拉单选/多选 -->
                          <el-select v-model="configForm[item.id]" :placeholder="lang.please_select"
                            v-if="item.option_type === 'select' || item.option_type ==='multi_select'"
                            :multiple="item.option_type ==='multi_select'" collapse-tags @change="changeItem(item)">
                            <el-option v-for="(item,index) in item.subs" :key="index" :label="item.option_name"
                              :value="item.id">
                            </el-option>
                          </el-select>
                          <!-- 是否 -->
                          <el-switch v-model="configForm[item.id]" v-if="item.option_type ==='yes_no'"
                            active-color="#0052D9" :active-value="calcSwitch(item,true)"
                            :inactive-value="calcSwitch(item,false)" @change="changeConfig(false)">
                          </el-switch>
                          <!-- 数据输入 -->
                          <el-input-number v-model.number="configForm[item.id]" :min="item.qty_min" :max="item.qty_max"
                            v-if="item.option_type ==='quantity'" @change="(val)=>fatherChange(val,item)">
                          </el-input-number>
                          <!-- 数量拖动 -->
                          <div class="slider" v-if="item.option_type ==='quantity_range'">
                            <span class="min">{{item.qty_min}}~</span>
                            <span class="max">{{item.qty_max}}</span>
                            <el-slider show-input :show-input-controls="false"
                              v-if="configForm[item.id] && configForm[item.id].length !==0"
                              v-model.number="configForm[item.id][0]" @change="(val)=>fatherChange(val,item)"
                              :min="item.qty_min" :max="item.qty_max" :step="item.subs[0]?.qty_change || 1">
                            </el-slider>
                          </div>
                          <!-- 点击单选 -->
                          <div class="click-select" v-if="item.option_type ==='radio'">
                            <div class="item" v-for="(el,index) in item.subs" :key="index"
                              :class="{'com-active': el.id === configForm[item.id]}" @click="changeClick(item.id, el)">
                              {{el.option_name}}
                              <i class="el-icon-check"></i>
                            </div>
                          </div>
                          <!-- 区域选择 -->
                          <div class="area-box" v-if="item.option_type ==='area'">
                            <p class="tit">{{lang.account_label4}}</p>
                            <div class="country">
                              <div class="item" v-for="(el,index) in filterCountry[item.id]" :key="index"
                                :class="{'com-active': index  === curCountry[item.id] }"
                                @click="changeCountry(item.id,index)">
                                <img :src="`upload/common/country/${el[0].country}.png`" alt="">
                                <span>{{calcCountry(el[0].country)}}</span>
                                <i class="el-icon-check"></i>
                              </div>
                            </div>
                            <p class="tit">{{lang.com_config.city}}</p>
                            <div class="city">
                              <div class="item" v-for="(el,index) in filterCountry[item.id][curCountry[item.id]]"
                                :key="index" :class="{'com-active': el.id  === configForm[item.id] }"
                                @click="changeCity(el, item.id)">
                                <img :src="`upload/common/country/${el.country}.png`" alt="">
                                <span>{{el.option_name}}</span>
                                <i class="el-icon-check"></i>
                              </div>
                            </div>
                          </div>
                          <!-- 后缀单位 -->
                          <span class="unit">{{item.unit}}</span>
                        </div>
                        <!-- 描述 -->
                        <!-- <p class="des" v-if="item.option_type !== 'area' && item.description" v-html="calcDes(item.description)"> -->
                        </p>
                      </div>
                      <!-- 周期 -->
                      <!-- <div class="config-item">
                        <p class="config-tit">{{lang.com_config.cycle}}</p>
                        <div class="onetime cycle" v-if="basicInfo.pay_type && basicInfo.pay_type === 'onetime'">
                          <div class="item com-active">
                            <p class="name">{{lang.common_cloud_text6}}</p>
                            <p class="price">{{commonData.currency_prefix}}{{onetime}}</p>
                            <i class="el-icon-check"></i>
                          </div>
                        </div>
                        <div class="onetime cycle" v-if="basicInfo.pay_type && basicInfo.pay_type === 'free'">
                          <div class="item com-active">
                            <p class="name">{{lang.product_free}}</p>
                            <p class="price">{{commonData.currency_prefix}}0.00</p>
                            <i class="el-icon-check"></i>
                          </div>
                        </div>
                        <div class="cycle"
                          v-if="basicInfo.pay_type && (basicInfo.pay_type === 'recurring_prepayment' || basicInfo.pay_type === 'recurring_postpaid')">
                          <div class="item" v-for="(item,index) in custom_cycles" :key="index"
                            @click="changeCycle(item,index)" :class="{'com-active': index === curCycle }">
                            <p class="name">{{item?.name}}</p>
                            <p class="price">{{commonData.currency_prefix}}{{((item.cycle_amount !== '' ?
                              item.cycle_amount : item.amount) * 1).toFixed(2) | filterMoney}}</p>
                            <i class="el-icon-check"></i>
                          </div>
                        </div>
                      </div> -->
                      <div class="sub-box">
                        <!-- 循环展示子商品 -->
                        <div class="sub-item" v-for="(sub,index) in upSon" :key="index">
                          <div class="pro-tit">{{basicInfo?.name}}-{{sub.basicInfo?.name}}</div>
                          <el-switch v-model="sub.open" class="sub-switch" active-color="#0052D9"
                            @change="changeSub"></el-switch>
                          <div v-show="sub.open">
                            <!-- <div class="description" v-html="calcDes(sub.basicInfo?.order_page_description)" v-if="sub.basicInfo?.order_page_description"></div> -->
                            <!-- 自定义配置项 -->
                            <div class="config-item" v-for="(item,index) in sub.configoptions" :key="index">
                              <p class="config-tit">{{item.option_name}}</p>
                              <!-- 配置项 -->
                              <div class="config-way">
                                <!-- 下拉单选/多选 -->
                                <el-select v-model="sonConfigForm[index][item.id]" :placeholder="lang.please_select"
                                  v-if="item.option_type === 'select' || item.option_type ==='multi_select'"
                                  :multiple="item.option_type ==='multi_select'" collapse-tags
                                  @change="changeItem(item)">
                                  <el-option v-for="(item,index) in item.subs" :key="index" :label="item.option_name"
                                    :value="item.id">
                                  </el-option>
                                </el-select>
                                <!-- 是否 -->
                                <el-switch v-model="sonConfigForm[index][item.id]" v-if="item.option_type ==='yes_no'"
                                  active-color="#0052D9" :active-value="calcSwitch(item,true)"
                                  :inactive-value="calcSwitch(item,false)" @change="changeConfig(false)">
                                </el-switch>
                                <!-- 数据输入 -->
                                <el-input-number :disabled="sub.basicInfo.configoption_id > 0"
                                  v-model.number="sonConfigForm[index][item.id]" :min="item.qty_min" :max="item.qty_max"
                                  v-if="item.option_type ==='quantity'" @change="changeConfig(false)">
                                </el-input-number>
                                <!-- 数量拖动 -->
                                <div class="slider" v-if="item.option_type ==='quantity_range'">
                                  <span class="min">{{item.qty_min}}~</span>
                                  <span class="max">{{item.qty_max}}</span>
                                  <el-slider show-input :show-input-controls="false"
                                    :disabled="sub.basicInfo.configoption_id > 0"
                                    v-if="sonConfigForm[index][item.id] && sonConfigForm[index][item.id].length !=0"
                                    v-model.number="sonConfigForm[index][item.id][0]"
                                    @change="(val)=>changeSonNum(val,item)" :min="item.qty_min" :max="item.qty_max"
                                    :step="item.subs[0]?.qty_change || 1">
                                  </el-slider>
                                </div>
                                <!-- 点击单选 -->
                                <div class="click-select" v-if="item.option_type ==='radio'">
                                  <div class="item" v-for="(el,index) in item.subs" :key="index"
                                    :class="{'com-active': el.id === sonConfigForm[index][item.id]}"
                                    @click="changeClick(item.id, el)">
                                    {{el.option_name}}
                                    <i class="el-icon-check"></i>
                                  </div>
                                </div>
                                <!-- 区域选择 -->
                                <div class="area-box" v-if="item.option_type ==='area'">
                                  <p class="tit">{{lang.account_label4}}</p>
                                  <div class="country">
                                    <div class="item" v-for="(el,index) in filterCountry[item.id]" :key="index"
                                      :class="{'com-active': index  === curCountry[item.id] }"
                                      @click="changeCountry(item.id,index)">
                                      <img :src="`upload/common/country/${el[0].country}.png`" alt="">
                                      <span>{{calcCountry(el[0].country)}}</span>
                                      <i class="el-icon-check"></i>
                                    </div>
                                  </div>
                                  <p class="tit">{{lang.com_config.city}}</p>
                                  <div class="city">
                                    <div class="item" v-for="el in filterCountry[item.id][curCountry[item.id]]"
                                      :class="{'com-active': el.id  === configForm[item.id] }"
                                      @click="changeCity(el, item.id)">
                                      <img :src="`upload/common/country/${el.country}.png`" alt="">
                                      <span>{{el.option_name}}</span>
                                      <i class="el-icon-check"></i>
                                    </div>
                                  </div>
                                </div>
                                <!-- 后缀单位 -->
                                <span class="unit">{{item.unit}}</span>
                              </div>
                              <!-- 描述 -->
                              <!-- <p class="des" v-if="item.option_type !== 'area' && item.description" v-html="calcDes(item.description)"> -->
                              </p>
                            </div>
                            <!-- 周期 -->
                            <!-- 当父商品的付费类型为周期的时候，子商品的周期不可选择，与父商品同步 -->
                            <div class="config-item"
                              :class="{sync: basicInfo.pay_type === 'recurring_prepayment' || basicInfo.pay_type === 'recurring_postpaid'}">
                              <p class="config-tit">{{lang.com_config.cycle}} <span v-if="sub.basicInfo.free"
                                  style="font-size: .14rem;color: #999;">（首周期免费）</span></p>
                              <div class="onetime cycle" v-if="sub.basicInfo.pay_type === 'onetime'">
                                <!-- <p>{{lang.product_onetime_free}}：{{commonData.currency_prefix}}{{sub.onetime}}</p> -->
                                <div class="item com-active">
                                  <p class="name">{{lang.common_cloud_text6}}</p>
                                  <p class="price">{{commonData.currency_prefix}}{{sub.onetime}}</p>
                                  <i class="el-icon-check"></i>
                                </div>
                              </div>
                              <div class="onetime cycle" v-if="sub.basicInfo.pay_type === 'free'">
                                <!-- <p>{{lang.product_free}}</p> -->
                                <div class="item com-active">
                                  <p class="name">{{lang.product_free}}</p>
                                  <p class="price">{{commonData.currency_prefix}}0.00</p>
                                  <i class="el-icon-check"></i>
                                </div>
                              </div>
                              <div class="cycle"
                                v-if="sub.basicInfo.pay_type === 'recurring_prepayment' || sub.basicInfo.pay_type === 'recurring_postpaid'">
                                <div class="item" v-for="(item,ind) in sub.custom_cycles" :key="item.id"
                                  @click="changeSubCycle(item,ind,index)"
                                  :class="{'com-active': ind === sonCurCycle[index] }">
                                  <p class="name">{{item.name}}</p>
                                  <p class="price">{{commonData.currency_prefix}}{{((item.cycle_amount !== '' ?
                                    item.cycle_amount : item.amount) * 1).toFixed(2) | filterMoney}}</p>
                                  <i class="el-icon-check"></i>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </el-tab-pane>
        </el-tabs>
      </div>
      <div slot="footer" class="dialog-footer">
        <div class="footer-price">
          <div class="lincense-price">升级所需费用：<span class="blue-text"
              v-loading="upPriceLoading">{{commonData.currency_prefix}} {{upData.totalPrice}}</span></div>
          <div class="footer-btnbox">
            <el-button type="primary" @click="handelUpConfirm" :loading="upBtnLoading">确 定</el-button>
            <el-button @click="upLicenseDialogShow = false">取 消</el-button>
          </div>
        </div>
      </div>
    </el-dialog>
  </div>
</div>
<!-- =======页面独有======= -->
<script src="/plugins/server/idcsmart_common/template/clientarea/api/common_config.js"></script>
<script src="/plugins/server/idcsmart_common/template/clientarea/utils/util.js"></script>
<script src="/plugins/server/idcsmart_common/template/clientarea/js/common_product_detail.js"></script>