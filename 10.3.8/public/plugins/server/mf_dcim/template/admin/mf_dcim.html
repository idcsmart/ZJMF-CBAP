<link rel="stylesheet" href="/plugins/server/mf_dcim/template/admin/css/mf-dcim.css">
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

<!-- =======内容区域======= -->
<div class="common_config">
  <div class="t-card">
    <t-tabs v-model="tabs" @change="changeTab">
      <!-- 周期设置 -->
      <t-tab-panel value="duration" :label="lang.mf_duration">
        <div class="box limit-table">
          <div class="com-top">
            <p class="tit">{{lang.mf_duration}}</p>
            <div class="right">
              <div class="add-btn" @click='changeRadio'>{{lang.cycle_ratio}}</div>
              <div class="add-btn" @click='addCycle'>{{lang.add_cycle}}</div>
            </div>
          </div>
          <p class="s-tip" style="line-height: 1;margin-top: -10px;">{{lang.mf_tip30}}</p>
          <t-table row-key="id" :data="cycleData" size="medium" :columns="cycleColumns" :hover="hover"
            :loading="loading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
            :hide-sort-tips="true">
            <template slot="sortIcon">
              <t-icon name="caret-down-small"></t-icon>
            </template>
            <template #unit="{row}">
              <span v-if="row.num">{{row.num}}</span>{{lang[row.unit]}}
            </template>
            <template #price_factor="{row}">
              {{row.price_factor.toFixed(2)}}
            </template>
            <template #price="{row}">
              <span>{{currency_prefix}}{{(row.price*1).toFixed(2)}}</span>
            </template>
            <template #ratio="{row}">
              <span>{{row.ratio || '--'}}</span>
            </template>
            <template #op="{row}">
              <div class="com-opt">
                <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                  <t-icon name="edit-1" @click="editCycle(row)"></t-icon>
                </t-tooltip>
                <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                  <t-icon name="delete" @click="comDel('cycle',row)"></t-icon>
                </t-tooltip>
              </div>
            </template>
          </t-table>
        </div>
      </t-tab-panel>
      <!-- 数据中心 -->
      <t-tab-panel value="data_center" :label="lang.data_center_config">
        <div class="box data-box limit-table1">
          <div class="com-top">
            <p class="tit">{{lang.data_center}}</p>
            <div class="r-btn">
              <div class="add-btn" @click='addData'>{{lang.invoice_btn6}}{{lang.data_center}}</div>
              <div class="add-btn line-btn" @click='addLine'>{{lang.invoice_btn6}}{{lang.line}}</div>
            </div>
          </div>
          <t-table row-key="id" :data="dataList" size="medium" :columns="dataColumns" :hover="hover"
            :loading="dataLoading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
            :hide-sort-tips="true">
            <template slot="sortIcon">
              <t-icon name="caret-down-small"></t-icon>
            </template>
            <template #area="{row}">
              <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                <t-icon name="edit-1" @click.native="editData(row)"></t-icon>
              </t-tooltip>
              {{row.area}}
            </template>
            <template #line="{row}">
              <template v-if="row.line.length > 0">
                <div class="item" v-for="(item,index) in row.line">
                  {{item.name}}
                </div>
              </template>
              <span class="p12" v-else>--</span>
            </template>
            <template #price="{row}">
              <template v-if="row.line.length > 0">
                <div class="item" v-for="(item,index) in row.line">
                  {{currency_prefix}}{{item.price}}
                  <template v-if="item.duration">/{{item.duration}}</template>
                  {{lang.rise}}&nbsp;&nbsp;{{lang['mf_'+item.bill_type]}}
                </div>
              </template>
              <span class="p12" v-else>--</span>
            </template>
            <template #op="{row}">
              <template v-if="row.line.length > 0">
                <div class="com-opt item" v-for="(item,index) in row.line">
                  <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                    <t-icon name="edit-1" @click="editLine(item)"></t-icon>
                  </t-tooltip>
                  <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                    <t-icon name="delete" @click="comDel('c_line',item)"></t-icon>
                  </t-tooltip>
                </div>
              </template>
              <div v-else style="padding: 12px 24px;" class="com-opt">
                <t-tooltip :content="`${lang.delete}${lang.data_center}`" :show-arrow="false" theme="light">
                  <t-icon name="delete" @click="comDel('data',row)"></t-icon>
                </t-tooltip>
              </div>
            </template>
          </t-table>
          <div class="config-tip">
            <span class="notes">{{lang.mf_notes}}</span>
            <p class="notes-txt">
              {{lang.mf_tip6}}<br>
              {{lang.mf_tip7}}<br>
              {{lang.mf_tip8}}<br>
            </p>
          </div>
        </div>
      </t-tab-panel>
      <!-- 机型配置 -->
      <t-tab-panel value="model" :label="lang.fixed_model">
        <div class="box">
          <div class="com-top">
            <p class="tit">{{lang.model_config}}</p>
            <div class="add-btn" @click="addCalc('model')">{{lang.order_text53}}{{lang.model_specs}}</div>
          </div>
          <p class="s-tip" style="line-height: 1;margin-top: -10px;">{{lang.mf_tip25}}</p>
          <t-table row-key="id" :data="modelList" size="medium" :columns="modelColumns" :hover="hover"
            class="model-table" :loading="modelLoading" table-layout="fixed" display-type="fixed-width"
            :hide-sort-tips="true" drag-sort="row-handler" @drag-sort="changeModelSort">
            <template slot="sortIcon">
              <t-icon name="caret-down-small"></t-icon>
            </template>
            <template #drag="{row}">
              <t-icon name="move"></t-icon>
            </template>
            <template #value="{row}">
              {{row.value}}
            </template>
            <template #price="{row}">
              <span>{{currency_prefix}}{{(row.price*1).toFixed(2)}}</span><template
                v-if="row.duration">/{{row.duration}}</template>
              &nbsp;{{lang.rise}}
            </template>
            <template #support_optional="{row}">
              {{row.support_optional === 1 ? lang.allow : lang.login_no}}
            </template>
            <template #hidden="{row}">
              <t-switch size="medium" :custom-value="[0,1]" v-model="row.hidden" @change="onChange(row)"></t-switch>
            </template>
            <template #gpu="{row}">
              {{row.gpu || "--"}}
            </template>
            <template #op="{row}">
              <div class="com-opt">
                <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                  <t-icon name="edit-1" @click="editCalc(row, 'model')"></t-icon>
                </t-tooltip>
                <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                  <t-icon name="delete" @click="comDel('model',row)"></t-icon>
                </t-tooltip>
              </div>
            </template>
          </t-table>
        </div>
      </t-tab-panel>
      <!-- 硬件配置 -->
      <t-tab-panel value="hardware" :label="lang.hardware_config">
        <div class="box limit-table">
          <div class="hard-box" v-for="(item, index) in hardwareArr" :key="index">
            <div class="com-top">
              <p class="tit">{{item.label}}{{lang.config}}</p>
              <div class="add-btn" @click='addHardware(item.name)'>{{lang.order_new}}{{item.label}}</div>
            </div>
            <t-table row-key="id" :data="calcHardwareData(item.name)" size="medium"
              :columns="calcHardwareColumns(item.name)" :hover="hover" :loading="calcHardwareLoading(item.name)"
              :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width" :hide-sort-tips="true">
              <template slot="sortIcon">
                <t-icon name="caret-down-small"></t-icon>
              </template>
              <template #price="{row}">
                {{currency_prefix}}{{row.price}}
                <template v-if="row.duration">/{{row.duration}}</template>
                {{lang.rise}}
              </template>
              <template #op="{row}">
                <div class="com-opt">
                  <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                    <t-icon name="edit-1" @click="editHard(item.name, row)"></t-icon>
                  </t-tooltip>
                  <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                    <t-icon name="delete" @click="comDel('hard',row, 0, item.name)"></t-icon>
                  </t-tooltip>
                </div>
              </template>
            </t-table>
          </div>
        </div>
      </t-tab-panel>
      <!-- 灵活机型 -->
      <!-- <t-tab-panel value="flexible" :label="lang.flexible_model">
        <div class="box">
          <div class="com-top">
            <p class="tit">{{lang.flexible_model}}</p>
            <div class="add-btn" @click="addFlex">{{lang.order_text53}}{{lang.model_specs}}</div>
          </div>
          <p class="s-tip" style="line-height: 1;margin-top: -10px;">{{lang.mf_p6}}</p>
          <t-table row-key="id" :data="packageList" size="medium" :columns="flexColumns" :hover="hover"
            class="model-table" :loading="flexLoading" table-layout="fixed" display-type="fixed-width"
            :hide-sort-tips="true">
            <template slot="sortIcon">
              <t-icon name="caret-down-small"></t-icon>
            </template>
            <template #name="{row}">
              <span>{{row.name}} <span class="flex-des" v-if="row.description">({{row.description}})</span></span>
            </template>
            <template #bw="{row}">
              {{row.bw}}M
            </template>
            <template #price="{row}">
              <span>{{currency_prefix}}{{(row.price*1).toFixed(2)}}</span><template
                v-if="row.duration">/{{row.duration}}</template>
              &nbsp;{{lang.rise}}
            </template>
            <template #hidden="{row}">
              <t-switch size="medium" :custom-value="[0,1]" v-model="row.hidden" @change="onChange(row)"></t-switch>
            </template>
            <template #op="{row}">
              <div class="com-opt">
                <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                  <t-icon name="edit-1" @click="editFlex(row)"></t-icon>
                </t-tooltip>
                <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                  <t-icon name="delete" @click="comDel('flex',row)"></t-icon>
                </t-tooltip>
              </div>
            </template>
          </t-table>
        </div>
      </t-tab-panel> -->
      <!-- 配置限制 -->
      <t-tab-panel value="limit" :label="lang.mf_limit">
        <div class="box limit-table limit-box">
          <p class="limit-tip">
            <img src="/plugins/server/mf_dcim/template/admin/img/warning.svg" alt="">
            {{lang.mf_tip19}}
          </p>
          <div class="limit-item">
            <div class="com-top">
              <p class="tit">
                {{lang.data_cpu_limit}}
              </p>
              <div class="add-btn" @click="addLimit">{{lang.order_text53}}{{lang.limit}}</div>
            </div>
            <t-table row-key="id" :data="limit_list" size="medium" :columns="limit_columns" :hover="hover"
              :loading="limit_loading" table-layout="auto" display-type="fixed-width" :hide-sort-tips="true">
              <template slot="sortIcon">
                <t-icon name="caret-down-small"></t-icon>
              </template>
              <template #area="{row}">
                {{row.country_name}}-{{row.city}}-{{row.area}}
              </template>
              <template #model="{row}">
                <span v-for="(item,index) in row.model_config" :key="index">
                  <template v-if="index !==0 && row.model_config.length > 1">,</template> {{item.name}}
                </span>
              </template>
              <template #bw="{row}">
                <!-- 4种情况 -->
                <template v-if="!row.line_name && !row.min_bw && !row.min_flow">
                  --
                </template>
                <template v-if="row.line_name && !row.min_bw && !row.max_bw && row.bill_type === 'bw'">
                  {{row.line_name}}（all）M
                </template>
                <template v-if="row.line_name && !row.min_flow && !row.max_flow && row.bill_type === 'flow'">
                  {{row.line_name}}（all）G
                </template>
                <template v-if="row.line_name && row.min_bw && row.bill_type === 'bw'">
                  {{row.line_name}}（{{row.min_bw}}-{{row.max_bw}}）M
                </template>
                <template v-if="row.line_name && row.min_flow && row.bill_type === 'flow'">
                  {{row.line_name}}（{{row.min_flow}}-{{row.max_flow}}）G
                </template>

              </template>
              <template #op="{row}">
                <div class="com-opt">
                  <t-icon name="edit-1" @click="editLimit('limit',row)"></t-icon>
                  <t-icon name="delete" @click="comDel('limit',row)"></t-icon>
                </div>
              </template>
            </t-table>
          </div>
        </div>
      </t-tab-panel>
      <!-- 操作系统 -->
      <t-tab-panel value="system" :label="lang.opt_system">
        <div class="box">
          <div class="top-opt">
            <div class="item">
              <t-select v-model="systemParams.image_group_id" class="select"
                :placeholder="`${lang.select}${lang.system_classify}`" clearable>
                <t-option :key="item.id" :value="item.id" :label="item.name" v-for="item in systemGroup">
                </t-option>
              </t-select>
              <t-input v-model="systemParams.keywords" class="ml_10" clearable
                :placeholder="`${lang.input}${lang.system_name}`"></t-input>
              <t-button class="ml_10" @click="getSystemList">{{lang.search}}</t-button>
            </div>
            <div class="item">
              <t-button @click="classManage">{{lang.news_classific}}{{lang.manage}}</t-button>
              <t-button @click="refeshImageHandler" theme="default" class="ml_10">{{lang.get_system}}</t-button>
              <div class="add-system ml_10" @click="createNewSys">{{lang.add}}{{lang.system}}</div>
            </div>
          </div>
          <t-table row-key="id" :data="systemList" size="medium" :columns="systemColumns" :hover="hover"
            :loading="loading" table-layout="auto" display-type="fixed-width" :hide-sort-tips="true">
            <template slot="sortIcon">
              <t-icon name="caret-down-small"></t-icon>
            </template>
            <template #image_group_name="{row}">
              <span class="class-name">
                <img :src="`/plugins/server/mf_dcim/template/admin/img/${row.icon}.svg`" alt="" class="icon">
                {{row.image_group_name}}
              </span>
            </template>
            <template #charge="{row}">
              <t-switch size="small" :custom-value="[1,0]" v-model="row.charge" @change="changeSystemStatus(row)">
              </t-switch>
            </template>
            <template #price="{row}">
              {{currency_prefix}}&nbsp;{{row.price}}
            </template>
            <template #enable="{row}">
              <t-switch size="small" :custom-value="[1,0]" v-model="row.enable" @change="changeSystemStatus(row)">
              </t-switch>
            </template>
            <template #op="{row}">
              <div class="com-opt">
                <t-icon name="edit-1" @click="editSystem(row)"></t-icon>
                <t-icon name="delete" @click="comDel('system',row)"></t-icon>
              </div>
            </template>
          </t-table>
        </div>
      </t-tab-panel>
      <!-- 其他设置 -->
      <t-tab-panel value="other" :label="lang.other_setting">
        <div class="box other-box">
          <t-form :data="otherForm" ref="otherConfig" @submit="submitConfig" :rules="dataRules" class="other-form">
            <div class="switch-box">
              <p class="tit">
                {{lang.apply_discount}}
                <span class="s-tip">{{lang.mf_p13}}</span>
              </p>
              <div class="item">
                <p class="s-item">--</p>
                <p class="s-item">{{lang.memory}}</p>
                <p class="s-item">{{lang.disk}}</p>
                <p class="s-item">{{lang.mf_gpu}}</p>
                <p class="s-item">{{lang.bw}}</p>
                <p class="s-item">IP</p>
              </div>
              <div class="item">
                <p class="s-item">{{lang.order_optional}}</p>
                <p class="s-item">
                  <t-switch :custom-value="[1,0]" v-model="otherForm.level_discount_memory_order" size="small">
                  </t-switch>
                </p>
                <p class="s-item">
                  <t-switch :custom-value="[1,0]" v-model="otherForm.level_discount_disk_order" size="small">
                  </t-switch>
                </p>
                <p class="s-item">
                  <t-switch :custom-value="[1,0]" v-model="otherForm.level_discount_gpu_order" size="small">
                  </t-switch>
                </p>
                <p class="s-item">--</p>
                <p class="s-item">--</p>
              </div>
              <div class="item">
                <p class="s-item">{{lang.upAndDown}}</p>
                <p class="s-item">
                  <t-switch :custom-value="[1,0]" v-model="otherForm.level_discount_memory_upgrade" size="small">
                  </t-switch>
                </p>
                <p class="s-item">
                  <t-switch :custom-value="[1,0]" v-model="otherForm.level_discount_disk_upgrade" size="small">
                  </t-switch>
                </p>
                <p class="s-item">
                  <t-switch :custom-value="[1,0]" v-model="otherForm.level_discount_gpu_upgrade" size="small">
                  </t-switch>
                </p>
                <p class="s-item">
                  <t-switch :custom-value="[1,0]" v-model="otherForm.level_discount_bw_upgrade" size="small">
                  </t-switch>
                </p>
                <p class="s-item">
                  <t-switch :custom-value="[1,0]" v-model="otherForm.level_discount_ip_num_upgrade" size="small">
                  </t-switch>
                </p>
              </div>
            </div>
            <t-form-item :label="`${lang.manual_resources}${lang.product}`">
              <t-switch :custom-value="[1,0]" v-model="otherForm.manual_resource" size="small">
              </t-switch>
              <span class="s-tip">{{lang.mf_p5}}</span>
            </t-form-item>
            <t-form-item :label="lang.mf_p14">
              <t-switch :custom-value="[1,0]" v-model="otherForm.optional_host_auto_create" size="small">
              </t-switch>
              <span class="s-tip">{{lang.mf_p15}}</span>
            </t-form-item>
            <t-form-item :label="lang.random_ssh">
              <t-switch :custom-value="[1,0]" v-model="otherForm.rand_ssh_port" size="small">
              </t-switch>
            </t-form-item>
            <t-form-item :label="lang.is_need_code1">
              <t-switch :custom-value="[1,0]" v-model="otherForm.reset_password_sms_verify" size="small">
              </t-switch>
            </t-form-item>
            <t-form-item :label="lang.is_need_code2">
              <t-switch :custom-value="[1,0]" v-model="otherForm.reinstall_sms_verify" size="small">
              </t-switch>
            </t-form-item>
            <t-button theme="primary" type="submit" :loading="submitLoading" class="submit"
              style="margin-top: 20px;">{{lang.hold}}
            </t-button>
          </t-form>
        </div>
      </t-tab-panel>
    </t-tabs>
  </div>
  <!-- 新增/修改 周期 -->
  <t-dialog :header="comTitle" :visible.sync="cycleModel" :footer="false" width="600" @close="closeData"
    :close-on-overlay-click="false">
    <t-form :data="cycleForm" ref="cycleForm" @submit="submitCycle" :rules="cycleRules" class="cycle-form"
      v-if="cycleModel">
      <t-form-item :label="lang.cycle_name" name="name">
        <t-input v-model="cycleForm.name" :placeholder="lang.input+lang.cycle_name"></t-input>
      </t-form-item>
      <t-form-item :label="lang.cycle_time" class="required">
        <t-form-item class="cycle_time" name="num" style="margin-bottom: 0;">
          <t-input v-model="cycleForm.num" :placeholder="lang.input+lang.cycle_time"></t-input>
        </t-form-item>
        <t-form-item>
          <t-select v-model="cycleForm.unit">
            <t-option :key="item.value" :value="item.value" :label="item.label" v-for="item in cycleTime">
            </t-option>
          </t-select>
        </t-form-item>
      </t-form-item>
      <t-form-item :label="lang.price_factor" name="price_factor">
        <t-input-number v-model="cycleForm.price_factor" :placeholder="lang.input+lang.factor" theme="normal"
          :decimal-places="2" :min="0" :max="9999">
        </t-input-number>
      </t-form-item>
      <t-form-item label=" " class="empty-item">
        <span>{{lang.mf_tip39}}</span>
      </t-form-item>
      <t-form-item :label="lang.cycle_price">
        <t-input-number v-model="cycleForm.price" :placeholder="lang.input+lang.price" theme="normal"
          :decimal-places="2" :min="0">
        </t-input-number>
      </t-form-item>
      <div class="com-f-btn">
        <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
        </t-button>
        <t-button theme="default" variant="base" @click="cycleModel=false">{{lang.cancel}}</t-button>
      </div>
    </t-form>
  </t-dialog>
  <!-- 周期比例 -->
  <t-dialog :header="lang.cycle_ratio" :visible.sync="ratioModel" :footer="false" width="600"
    :close-on-overlay-click="false">
    <t-table row-key="id" :data="ratioData" size="medium" :columns="ratioColumns" :hover="hover" :loading="loading"
      :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width" :hide-sort-tips="true">
      <template #unit="{row}">
        <span>{{row.num}}{{lang[row.unit]}}</span>
      </template>
      <template #ratio="{row}">
        <t-input-number v-model="row.ratio" :placeholder="lang.input+lang.mf_ratio" theme="normal" :decimal-places="2"
          :min="0.01">
        </t-input-number>
      </template>
    </t-table>
    <div class="ratio-tip">
      <p>*{{lang.mf_notes}}</p>
      <p>{{lang.mf_ratio_tip1}}</p>
      <p>{{lang.mf_ratio_tip2}}</p>
      <p>{{lang.mf_ratio_tip3}}</p>
      <p>{{lang.mf_ratio_tip4}}</p>
    </div>
    <div class="com-f-btn">
      <t-button theme="primary" @click="saveRatio" :loading="submitLoading">{{lang.hold}}
      </t-button>
      <t-button theme="default" variant="base" @click="ratioModel=false">{{lang.cancel}}</t-button>
    </div>
  </t-dialog>
  <!-- 新增/编辑系统 -->
  <t-dialog :header="comTitle" :visible.sync="systemModel" :footer="false" width="600" @close="closeData"
    :close-on-overlay-click="false">
    <t-form :data="createSystem" ref="cycleForm" @submit="submitSystem" :rules="cycleRules" class="cycle-form"
      v-if="systemModel">
      <t-form-item :label="lang.system_classify" name="image_group_id">
        <t-select v-model="createSystem.image_group_id" class="select"
          :placeholder="`${lang.select}${lang.system_classify}`" clearable>
          <t-option :key="item.id" :value="item.id" :label="item.name" v-for="item in systemGroup">
          </t-option>
        </t-select>
      </t-form-item>
      <t-form-item :label="lang.system_name" name="name" :rules="[
      { required: true, message: lang.input + lang.system_name, type: 'error' },
      ]">
        <t-input v-model="createSystem.name" :placeholder="lang.input+lang.system_name"></t-input>
      </t-form-item>
      <t-form-item :label="lang.opt_system + 'ID'" name="rel_image_id">
        <t-input v-model="createSystem.rel_image_id" :placeholder="lang.input+lang.opt_system + 'ID'"></t-input>
      </t-form-item>
      <t-form-item :label="lang.mf_charge">
        <t-switch size="small" :custom-value="[1,0]" v-model="createSystem.charge">
        </t-switch>
      </t-form-item>
      <t-form-item :label="lang.price" v-if="createSystem.charge" name="price">
        <t-input v-model="createSystem.price" :placeholder="lang.input+lang.price"></t-input>
      </t-form-item>
      <t-form-item :label="lang.mf_enable">
        <t-switch size="small" :custom-value="[1,0]" v-model="createSystem.enable">
        </t-switch>
      </t-form-item>
      <div class="com-f-btn">
        <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
        </t-button>
        <t-button theme="default" variant="base" @click="systemModel=false">{{lang.cancel}}</t-button>
      </div>
    </t-form>
  </t-dialog>
  <!-- 新增/编辑分类管理-->
  <t-dialog :header="`${lang.classific_manage}`" :visible.sync="classModel" :footer="false" width="600"
    @close="closeData" :close-on-overlay-click="false" class="class-dialog">
    <t-form :data="classParams" ref="classForm" @submit="submitSystemGroup" :rules="cycleRules" class="cycle-form"
      v-if="classModel">
      <t-form-item :label="lang.system_name" name="name" :rules="[
      { required: true, message: lang.input + lang.system_name, type: 'error', trigger: 'blur' }]">
        <t-input v-model="classParams.name" placeholder=" "></t-input>
      </t-form-item>
      <t-form-item :label="lang.mf_icon" name="icon">
        <t-select v-model="classParams.icon" :popup-props="popupProps" class="custom-select"
          :placeholder="`${lang.select}${lang.mf_icon}`" clearable>
          <img class="s-icon" :class="{noIcon: !classParams.icon}" slot="prefixIcon" style="margin-right: 8px"
            :src="`/plugins/server/mf_dcim/template/clientarea/img/mf_dcim/${classParams.icon}.svg`" />
          <t-option :key="index" :value="item.value" :label="item.label" v-for="(item,index) in iconSelecet"
            class="custom-icon">
            <img :src="item.label" alt="" class="icon">
          </t-option>
        </t-select>
        <t-button theme="primary" type="submit" :loading="submitLoading" style="margin-left: 14px;">{{lang.hold}}
        </t-button>
      </t-form-item>
    </t-form>
    <!-- 分类表格 -->
    <t-table row-key="id" :data="systemGroup" size="medium" :columns="groupColumns" :hover="hover" :loading="loading"
      table-layout="auto" display-type="fixed-width" :hide-sort-tips="true" max-height="450px" style="margin-top: 30px;"
      drag-sort="row-handler" @drag-sort="changeSort">
      <template slot="sortIcon">
        <t-icon name="caret-down-small"></t-icon>
      </template>
      <template #drag="{row}">
        <t-icon name="move"></t-icon>
      </template>
      <template #image_group_name="{row}">
        <span class="class-name">
          <img :src="`/plugins/server/mf_dcim/template/admin/img/${row.icon}.svg`" alt="" class="icon">
          {{row.name}}
        </span>
      </template>
      <template #op="{row}">
        <div class="com-opt">
          <t-icon name="edit-1" @click="editGroup(row)"></t-icon>
          <t-icon name="delete" @click="comDel('group',row)"></t-icon>
        </div>
      </template>
    </t-table>
  </t-dialog>
  <!-- 新增/修改 机型配置 -->
  <t-dialog :header="comTitle" :visible.sync="calcModel" :footer="false" width="1440" @close="closeData"
    :close-on-overlay-click="false" class="cpuDialog flex-dialog">
    <t-form :data="calcForm" ref="cycleForm" @submit="submitCalc" :rules="calcRules" class="cycle-form" v-if="calcModel"
      label-align="top">
      <div class="flex-box">
        <div class="form-item">
          <p class="com-tit">
            <span>{{lang.install_text4}}</span>
          </p>
          <div class="short-item">
            <t-form-item :label="lang.config_name" name="name">
              <t-input v-model="calcForm.name" :placeholder="lang.input+lang.config_name"></t-input>
            </t-form-item>
            <t-form-item :label="`${lang.sale_group}ID`" name="group_id">
              <t-input v-model="calcForm.group_id" :placeholder="`${lang.input}${lang.sale_group}ID`"></t-input>
            </t-form-item>
          </div>
          <div class="short-item">
            <t-form-item :label="lang.mf_cpu" name="cpu">
              <t-select v-model="calcForm.cpu" :placeholder="lang.mf_p22" creatable filterable
                @create="createOptions($event, 'cpu')">
                <t-option v-for="item in cpuList" :value="item.value" :label="item.value" :key="item.id"></t-option>
              </t-select>
            </t-form-item>
            <t-form-item :label="lang.mf_cpu_param" name="cpu_param">
              <t-input v-model="calcForm.cpu_param" :placeholder="lang.mf_p2" :maxlength="30"></t-input>
            </t-form-item>
          </div>
          <div class="short-item">
            <t-form-item :label="lang.memory" name="memory">
              <t-select v-model="calcForm.memory" :placeholder="lang.mf_p22" creatable filterable
                @create="createOptions($event, 'memory')">
                <t-option v-for="item in memoryList" :value="item.value" :label="item.value" :key="item.id"></t-option>
              </t-select>
            </t-form-item>
            <t-form-item :label="lang.disk" name="disk">
              <t-select v-model="calcForm.disk" :placeholder="lang.mf_p22" creatable filterable
                @create="createOptions($event, 'disk')">
                <t-option v-for="item in diskList" :value="item.value" :label="item.value" :key="item.id"></t-option>
              </t-select>
            </t-form-item>
          </div>
          <div class="short-item">
            <t-form-item :label="lang.mf_gpu">
              <t-select v-model="calcForm.gpu" :placeholder="lang.mf_p22" creatable filterable clearable
                @create="createOptions($event, 'gpu')">
                <t-option v-for="item in gpuList" :value="item.value" :label="item.value" :key="item.id"></t-option>
              </t-select>
            </t-form-item>
            <t-form-item></t-form-item>
          </div>
          <p class="com-tit">
            <span>{{lang.price_config}}</span>
          </p>
          <!-- 周期价格 -->
          <t-form-item :label="lang.order_text86">
            <div class="price-box">
              <div class="item" v-for="(item,index) in calcForm.price" :key="item.id">
                <p class="txt">{{item.name}}</p>
                <p class="num">
                  <!-- 循环验证 -->
                  <t-form-item :name="`price[${index}].price`"
                    :ruels="[ item.price * 1 ? calcRules.price : {required: true} ]">
                    <t-input v-model="item.price" @blur="blurPrice($event,index)"
                      :placeholder="(calcForm.type === 'step' || calcForm.type === 'total') ? lang.mf_tip9: lang.input+lang.money"></t-input>
                  </t-form-item>
                </p>
              </div>
              <!-- 自动填充 -->
              <div class="item">
                <p class="txt"></p>
                <p class="num"><t-button size="small" :disabled="isShowFill(calcForm.price)"
                    @click="autoFill('calcForm',calcForm.price)">{{lang.autofill}}</t-button>
                </p>
              </div>
            </div>
          </t-form-item>
          <div class="box-tip">
            <p class="s-tip">{{lang.order_text36}}：</p>
            <p class="s-tip">1.{{lang.mf_p16}}</p>
            <p class="s-tip">2.{{lang.mf_p17}}</p>
          </div>
        </div>
        <div class="form-item">
          <p class="com-tit">
            <span>{{lang.mf_p18}}</span>
          </p>
          <p class="option-switch">
            {{lang.mf_p19}}
            <t-switch :custom-value="[1,0]" v-model="calcForm.support_optional" size="small">
            </t-switch>
            <span class="s-tip">{{lang.mf_p20}}</span>
          </p>
          <p class="option-tit">{{lang.memory}}</p>
          <t-form-item label="" class="three-item">
            <t-form-item :label="lang.mf_p23">
              <t-input-number v-model="calcForm.max_memory_num" :placeholder="lang.input" theme="normal" :min="0"
                :decimal-places="0" :disabled="calcForm.support_optional === 0"></t-input-number>
                <span class="s-tip">{{lang.mf_p21}}</span>
            </t-form-item>
            <t-form-item :label="lang.mf_p24">
              <t-select v-model="calcForm.optional_memory_id" :placeholder="lang.select" multiple clearable
              :min-collapsed-num="1" :disabled="calcForm.support_optional === 0">
                <t-option v-for="item in calcOriginData('memoryList')" :value="item.id" :label="item.value" :key="item.id"></t-option>
              </t-select>
            </t-form-item>
            <t-form-item :label="lang.mf_p26" class="unit-box">
              <t-input-number v-model="calcForm.leave_memory" :placeholder="lang.input" theme="normal" :min="0"
                :decimal-places="0" :disabled="calcForm.support_optional === 0">
              </t-input-number>
              <span class="unit">G</span>
            </t-form-item>
          </t-form-item>
          <p class="option-tit">{{lang.disk}}</p>
          <t-form-item :label="lang.disk" class="three-item">
            <t-form-item :label="lang.mf_p25">
              <t-input-number v-model="calcForm.max_disk_num" :placeholder="lang.input" theme="normal" :min="0"
                :decimal-places="0" :disabled="calcForm.support_optional === 0">
              </t-input-number>
              <span class="s-tip">{{lang.mf_p21}}</span>
            </t-form-item>
            <t-form-item :label="lang.mf_p24">
              <t-select v-model="calcForm.optional_disk_id" :placeholder="lang.select" multiple clearable
             :min-collapsed-num="1" :disabled="calcForm.support_optional === 0">
                <t-option v-for="item in calcOriginData('diskList')" :value="item.id" :label="item.value" :key="item.id"></t-option>
              </t-select>
            </t-form-item>
          </t-form-item>
          <p class="option-tit">{{lang.mf_gpu}}</p>
          <t-form-item label="" class="three-item">
            <t-form-item :label="lang.mf_p28">
              <t-input-number v-model="calcForm.max_gpu_num" :placeholder="lang.input" theme="normal" :min="0"
                :decimal-places="0" :disabled="calcForm.support_optional === 0">
              </t-input-number>
              <span class="s-tip">{{lang.mf_p21}}</span>
            </t-form-item>
            <t-form-item :label="lang.mf_p24">
              <t-select v-model="calcForm.optional_gpu_id" :placeholder="lang.select" multiple clearable
                :min-collapsed-num="1" :disabled="calcForm.support_optional === 0">
                <t-option v-for="item in calcOriginData('gpuList')" :value="item.id" :label="item.value" :key="item.id"></t-option>
              </t-select>
            </t-form-item>
          </t-form-item>
          <div class="box-tip">
            <p class="s-tip">{{lang.order_text36}}：</p>
            <p class="s-tip">1.{{lang.mf_p27}}</p>
            <p class="s-tip">2.{{lang.mf_p28}}</p>
          </div>
        </div>
      </div>
      <div class="com-f-btn">
        <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
        </t-button>
        <t-button theme="default" variant="base" @click="calcModel=false">{{lang.cancel}}</t-button>
      </div>
    </t-form>
  </t-dialog>
  <!-- 新增/修改 灵活机型 -->
  <t-dialog :header="comTitle" :visible.sync="flexModel" :footer="false" width="1000" @close="closeData"
    :close-on-overlay-click="false" class="cpuDialog flex-dialog">
    <t-form :data="flexForm" ref="flexForm" @submit="submitFlex" :rules="hardRules" label-align="top" class="cycle-form"
      v-if="flexModel">
      <p class="flex-tit">{{lang.mf_recommend}}</p>
      <div class="flex-box">
        <div class="form-item">
          <div class="short-item">
            <t-form-item :label="lang.model_name" name="name">
              <t-input v-model="flexForm.name" :placeholder="lang.input+lang.model_name"></t-input>
            </t-form-item>
            <t-form-item :label="`${lang.sort}ID`" name="order">
              <t-input v-model="flexForm.order" :placeholder="`${lang.input}${lang.sort}ID`"></t-input>
            </t-form-item>
          </div>
          <t-form-item :label="lang.mf_cpu" class="required">
            <t-form-item name="cpu_option_id" :required-mark="false">
              <t-select v-model="flexForm.cpu_option_id" :placeholder="`${lang.select}${lang.mf_cpu}`">
                <t-option v-for="item in cpuList" :value="item.id" :label="item.value" :key="item.id"></t-option>
              </t-select>
            </t-form-item>
            <t-form-item name="cpu_num" :required-mark="false">
              <t-input-number v-model="flexForm.cpu_num" :placeholder="`${lang.auth_num}`" theme="normal" :min="1"
                :decimal-places="0"></t-input-number>
            </t-form-item>
          </t-form-item>
          <t-form-item :label="lang.disk" class="required">
            <t-form-item name="disk_option_id" :required-mark="false">
              <t-select v-model="flexForm.disk_option_id" :placeholder="`${lang.select}${lang.disk}`">
                <t-option v-for="item in diskList" :value="item.id" :label="item.value" :key="item.id"></t-option>
              </t-select>
            </t-form-item>
            <t-form-item name="disk_num" :required-mark="false">
              <t-input-number v-model="flexForm.disk_num" :placeholder="`${lang.auth_num}`" theme="normal" :min="1"
                :decimal-places="0">
              </t-input-number>
            </t-form-item>
          </t-form-item>
          <t-form-item :label="`IP${lang.auth_num}`" name="ip_num">
            <t-input-number v-model="flexForm.ip_num" :placeholder="`${lang.input}IP${lang.auth_num}`" theme="normal"
              :min="1" :decimal-places="0">
            </t-input-number>
          </t-form-item>
        </div>
        <div class="form-item">
          <t-form-item :label="`${lang.group}ID`" name="group_id">
            <t-input v-model="flexForm.group_id" :placeholder="`${lang.input}${lang.group}ID`"></t-input>
          </t-form-item>
          <t-form-item :label="lang.memory" class="required">
            <t-form-item name="mem_option_id" :required-mark="false">
              <t-select v-model="flexForm.mem_option_id" :placeholder="`${lang.select}${lang.memory}`">
                <t-option v-for="item in memoryList" :value="item.id" :label="item.value" :key="item.id"></t-option>
              </t-select>
            </t-form-item>
            <t-form-item name="mem_num" :required-mark="false">
              <t-input-number v-model="flexForm.mem_num" :placeholder="`${lang.auth_num}`" theme="normal" :min="1"
                :decimal-places="0">
              </t-input-number>
            </t-form-item>
          </t-form-item>
          <t-form-item :label="lang.bw" name="bw">
            <t-input-number v-model="flexForm.bw" :placeholder="`${lang.input}${lang.bw}`" theme="normal" :min="1"
              :decimal-places="0">
            </t-input-number>
            <span class="unit">M</span>
          </t-form-item>
          <t-form-item :label="lang.description">
            <t-input v-model="flexForm.description" :placeholder="lang.input+lang.description"
              :maxlength="30"></t-input>
          </t-form-item>
        </div>
      </div>
      <!-- 选配内容 -->
      <p class="flex-tit">{{lang.optional_content}}</p>

      <div class="flex-box">
        <div class="form-item">
          <t-form-item :label="lang.optional_memory">
            <t-select v-model="flexForm.optional_memory_id" :placeholder="lang.optional_memory" multiple clearable
              @change="changeRange" :min-collapsed-num="1">
              <t-option :value="0" :label="lang.no_optional" :key="0"></t-option>
              <t-option v-for="item in memoryList" :value="item.id" :label="item.value" :key="item.id"></t-option>
            </t-select>
          </t-form-item>
          <t-form-item :label="lang.max_slot">
            <t-input-number v-model="flexForm.mem_max_num" :placeholder="lang.mf_p7" theme="normal" :min="0"
              :decimal-places="0" :disabled="flexForm.optional_memory_id[0] === 0"></t-input-number>
          </t-form-item>
        </div>
        <div class="form-item">
          <t-form-item :label="lang.max_size">
            <t-input-number v-model="flexForm.mem_max" :placeholder="lang.mf_p7" theme="normal" :min="0"
              :decimal-places="0" :disabled="flexForm.optional_memory_id[0] === 0">
            </t-input-number>
            <span class="unit">G</span>
          </t-form-item>
        </div>
      </div>
      <div class="flex-box">
        <div class="form-item">
          <t-form-item :label="lang.optional_disk">
            <t-select v-model="flexForm.optional_disk_id" :placeholder="lang.optional_disk" multiple clearable
              @change="changeMemRange" :min-collapsed-num="1">
              <t-option :value="0" :label="lang.no_optional" :key="0"></t-option>
              <t-option v-for="item in diskList" :value="item.id" :label="item.value" :key="item.id"></t-option>
            </t-select>
          </t-form-item>
        </div>
        <div class="form-item">
          <t-form-item :label="lang.max_number">
            <t-input-number v-model="flexForm.disk_max_num" :placeholder="lang.mf_p7" theme="normal" :min="0"
              :decimal-places="0" :disabled="flexForm.optional_disk_id[0] === 0"></t-input-number>
          </t-form-item>
        </div>
      </div>
      <div class="flex-box">
        <div class="form-item">
          <!-- 周期价格 -->
          <t-form-item :label="lang.price_config">
            <div class="price-box">
              <div class="item" v-for="(item,index) in flexForm.price" :key="item.id">
                <p class="txt">{{item.name}}</p>
                <p class="num">
                  <!-- 循环验证 -->
                  <t-form-item :name="`price[${index}].price`"
                    :ruels="[ item.price * 1 ? calcRules.price : {required: true} ]">
                    <t-input v-model="item.price" @blur="blurFlexPrice($event,index)"
                      :placeholder="lang.input+lang.money"></t-input>
                  </t-form-item>
                </p>
              </div>
              <!-- 自动填充 -->
              <div class="item">
                <p class="txt"></p>
                <p class="num"><t-button size="small" :disabled="isShowFill(flexForm.price)"
                    @click="autoFill('flexForm',flexForm.price)">{{lang.autofill}}</t-button>
                </p>
              </div>
            </div>
          </t-form-item>
        </div>
        <div class="form-item">
          <div class="tip-box">
            <p>{{lang.mf_notes}}</p>
            <p>1.{{lang.mf_p8}}</p>
            <p>2.{{lang.mf_p9}}</p>
            <p>3.{{lang.mf_p10}}</p>
            <p>4.{{lang.mf_p11}}</p>
          </div>
        </div>
      </div>

      <div class="com-f-btn">
        <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
        </t-button>
        <t-button theme="default" variant="base" @click="flexModel=false">{{lang.cancel}}</t-button>
      </div>
    </t-form>
  </t-dialog>
  <!-- 新增/修改数据中心弹窗 -->
  <t-dialog :header="comTitle" :visible.sync="dataModel" :footer="false" width="635" @close="closeData">
    <t-form :data="dataForm" ref="dataForm" @submit="submitData" :rules="dataRules" class="data-form" v-if="dataModel">
      <t-form-item :label="lang.country" class="required">
        <t-form-item name="country_id" class="configs" :required-mark="false">
          <t-select v-model="dataForm.country_id" class="flow-type" :placeholder="lang.select+lang.country" filterable
            :popup-props="{ overlayClassName: `custom-data`, overlayStyle: (trigger) => ({ width: `${trigger.offsetWidth}px` })}">
            <img class="s-icon" :class="{'noIcon': !dataForm.country_id }" slot="prefixIcon" :src="calcIcon" />
            <t-option :key="item.id" :value="item.id" :label="item.name_zh" v-for="item in countryList"
              class="custom-icon">
              <img :src="`${host}/upload/common/country/${item.iso}.png`" alt="" class="icon">
              {{item.name_zh}}
            </t-option>
          </t-select>
        </t-form-item>
        <t-form-item label="" name="city" class="configs" :required-mark="false" :rules="[
        { required: true, message: lang.input + lang.city, type: 'error' }]">
          <t-input v-model="dataForm.city" :placeholder="lang.input+lang.city"></t-input>
        </t-form-item>
      </t-form-item>
      <t-form-item :label="`${lang.area}${lang.nickname}`" name="area">
        <t-input v-model="dataForm.area" :placeholder="`${lang.input}${lang.area}${lang.nickname}`"></t-input>
      </t-form-item>
      <t-form-item :label="lang.sort" name="order">
        <t-input-number v-model="dataForm.order" theme="normal" :max="999" :min="0" :decimal-places="0"
          :placeholder="`${lang.input}${lang.sort}ID`"></t-input-number>
      </t-form-item>
      <div class="com-f-btn">
        <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
        </t-button>
        <t-button theme="default" variant="base" @click="closeData">{{lang.cancel}}</t-button>
      </div>
    </t-form>
  </t-dialog>
  <!-- 新增/修改 硬件配置 -->
  <t-dialog :header="comTitle" :visible.sync="hardDialog" :footer="false" width="600" @close="closeData"
    :close-on-overlay-click="false" class="cpuDialog">
    <t-form :data="hardwareForm" ref="cycleForm" @submit="submitHard" :rules="hardRules" class="cycle-form"
      v-if="hardDialog">
      <t-form-item :label="calcHardValue" name="value" :rules="[{
        required: true,
        message: lang.input + calcHardValue,
        type: 'error'}]">
        <t-input v-model="hardwareForm.value"
          :placeholder="`${lang.input}${hardMode === 'memory' ? (lang.memory + lang.nickname + '，'+ lang.mf_example + '：2G') :calcHardValue}`"></t-input>
      </t-form-item>
      <t-form-item :label="lang.sort" name="order" v-if="hardMode !== 'cpu'">
        <t-input-number v-model="hardwareForm.order" theme="normal" :min="0" :max="999" :decimal-places="0"
          :placeholder="`${lang.input}${lang.sort}`">
        </t-input-number>
      </t-form-item>
      <t-form-item :label="lang.memory_slot" name="other_config.memory_slot" v-if="hardMode === 'memory'">
        <t-input-number v-model="hardwareForm.other_config.memory_slot" theme="normal" :min="0" :decimal-places="0"
          :placeholder="`${lang.input}${lang.memory_slot_num}`">
        </t-input-number>
      </t-form-item>
      <t-form-item :label="`${lang.memory}${lang.capacity}`" name="other_config.memory" v-if="hardMode === 'memory'">
        <t-input-number v-model="hardwareForm.other_config.memory" theme="normal" :min="0" :decimal-places="0"
          :placeholder="`${lang.input}${lang.memory}${lang.capacity}，${lang.mf_example}：2`">
        </t-input-number>
      </t-form-item>
      <!-- 周期价格 -->
      <t-form-item :label="lang.price_config">
        <div class="price-box">
          <div class="item" v-for="(item,index) in hardwareForm.price" :key="item.id">
            <p class="txt">{{item.name}}</p>
            <p class="num">
              <!-- 循环验证 -->
              <t-form-item :name="`price[${index}].price`"
                :ruels="[ item.price * 1 ? hardRules.price : {required: true} ]">
                <t-input v-model="item.price" @blur="blurHardPrice($event,index)"
                  :placeholder="lang.input+lang.money"></t-input>
              </t-form-item>
            </p>
          </div>
          <!-- 自动填充 -->
          <div class="item">
            <p class="txt"></p>
            <p class="num"><t-button size="small" :disabled="isShowFill(hardwareForm.price)"
                @click="autoFill('hardwareForm',hardwareForm.price)">{{lang.autofill}}</t-button>
            </p>
          </div>
        </div>
      </t-form-item>
      <div class="com-f-btn">
        <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
        </t-button>
        <t-button theme="default" variant="base" @click="hardDialog=false">{{lang.cancel}}</t-button>
      </div>
    </t-form>
  </t-dialog>
  <!-- 新增/修改 线路 -->
  <t-dialog :header="lang.line" :visible.sync="lineModel" :footer="false" width="1072" @close="closeData"
    class="line-form" :close-on-overlay-click="false" placement="center">
    <t-form :data="lineForm" ref="lineForm" @submit="submitLine" :rules="dataRules" class="data-form" v-if="lineModel">
      <div class="top">
        <div class="sort">
          <t-form-item :label="lang.country" class="required" v-if="lineType === 'add'">
            <t-form-item name="country_id" class="configs" :required-mark="false">
              <t-select v-model="lineForm.country_id" class="flow-type" :placeholder="lang.select+lang.country"
                filterable @change="changeCountry"
                :popup-props="{ overlayClassName: `custom-data`, overlayStyle: (trigger) => ({ width: `${trigger.offsetWidth}px` })}">
                <img class="s-icon" :class="{'noIcon': !dataForm.country_id && !lineForm.country_id }" slot="prefixIcon"
                  :src="calcIcon1" />
                <t-option :key="item.id" :value="item.id" :label="item.name" v-for="item in countrySelect"
                  class="custom-icon">
                  <img :src="`${host}/upload/common/country/${item.iso}.png`" alt="" class="icon">
                  {{item.name}}
                </t-option>
              </t-select>
            </t-form-item>
            <t-form-item label="" name="city" class="configs" :required-mark="false">
              <t-select v-model="lineForm.city" class="flow-type" @change="changeCity"
                :placeholder="lang.select+lang.city">
                <t-option :key="c" :value="city.name" :label="city.name" v-for="(city, c) in calcCity">
                </t-option>
              </t-select>
            </t-form-item>
            <t-form-item label="" name="data_center_id" class="configs" :required-mark="false">
              <t-select v-model="lineForm.data_center_id" class="flow-type" :placeholder="lang.select+lang.area">
                <t-option :key="area.id" :value="area.id" :label="area.name" v-for="area in calcArea">
                </t-option>
              </t-select>
            </t-form-item>
          </t-form-item>
        </div>
        <div class="sort">
          <t-form-item :label="lang.line_name" name="name" class="line-name"
            :rules="[{ required: true, message: `${lang.input}${lang.line_name}`, type: 'error' },]">
            <t-input v-model="lineForm.name" :placeholder="lang.input+lang.line_name" :maxlength="50"></t-input>
          </t-form-item>
          <t-form-item :label="lang.sort" name="order" label-width="120px">
            <t-input-number v-model="lineForm.order" theme="normal" :max="999" :min="0" :decimal-places="0"
              :placeholder="`${lang.input}${lang.sort}`"></t-input-number>
          </t-form-item>
        </div>
      </div>
      <div class="bg"></div>
      <div class="config">
        <p class="p-tit">{{lang.bw_price_config}}</p>
        <div class="con">
          <!-- 左侧 -->
          <div class="c-item">
            <t-form-item :label="`${lang.billing_way}`" name="bill_type" label-align="left" class="required"
              v-if="lineType === 'add'">
              <t-select v-model="lineForm.bill_type" class="bill-type" @change="lineRight=false">
                <t-option :key="item.value" :value="item.value" :label="item.label" v-for="item in billType">
                </t-option>
              </t-select>
            </t-form-item>
            <!-- bw_data -->
            <template v-if="lineForm.bill_type === 'bw'">
              <div class="com-top">
                <p class="tit">
                  {{lang.billing_way}}
                  <template v-if="calcSubTitle(lineForm.bw_data)">
                    {{calcSubTitle(lineForm.bw_data)}}
                  </template>
                </p>
                <div class="add-btn gray" @click="addLineSub('line_bw')">{{lang.order_text53}}</div>
              </div>
              <t-table row-key="id" :data="lineForm.bw_data" size="medium" :columns="bwColumns" :hover="hover"
                :loading="loading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
                :hide-sort-tips="true">
                <template slot="sortIcon">
                  <t-icon name="caret-down-small"></t-icon>
                </template>
                <template #fir="{row}">
                  <template v-if="row.type==='radio'">
                    {{row.value}}
                  </template>
                  <template v-else>
                    {{row.min_value}}-{{row.max_value}}
                  </template>
                </template>
                <template #price="{row}">
                  <!-- 新增线路的时候本地处理显示 -->
                  {{currency_prefix}}
                  <template v-if="lineType === 'add'">
                    {{calcPrice(row.price)}}
                  </template>
                  <template v-else>
                    {{(row.price*1).toFixed(2)}}
                    <template v-if="row.duration">/{{row.duration}}</template>
                  </template>
                  &nbsp;{{lang.rise}}
                </template>
                <template #op="{row, rowIndex}">
                  <div class="com-opt">
                    <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                      <t-icon name="edit-1" @click="editSubItem(row,rowIndex,'line_bw')"></t-icon>
                    </t-tooltip>
                    <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                      <t-icon name="delete" @click="comDel('line_bw',row,rowIndex)"></t-icon>
                    </t-tooltip>
                  </div>
                </template>
              </t-table>
              <p class="advance_config" @click="bw_ip_show = !bw_ip_show">
                {{lang.advance_config}}
                <template>
                  <t-icon :name="bw_ip_show ? 'chevron-up' : 'chevron-down'"></t-icon>
                </template>
              </p>
              <!-- 高级设置 -->
              <div class="advance_box" v-show="bw_ip_show">
                <t-form-item :label="`IP${lang.group}`" label-align="top">
                  <t-input v-model="lineForm.bw_ip_group" :placeholder="lang.input"></t-input>
                </t-form-item>
              </div>
            </template>
            <template v-else>
              <!-- 流量 -->
              <div class="com-top">
                <p class="tit">
                  {{lang.traffic_billing}}
                  <template v-if="calcSubTitle(lineForm.flow_data)"></template>
                </p>
                <div class="add-btn gray" @click="addLineSub('line_flow')">{{lang.order_text53}}</div>
              </div>
              <t-table row-key="id" :data="lineForm.flow_data" size="medium" :columns="calcColums('flow')"
                :hover="hover" :loading="loading" :table-layout="tableLayout ? 'auto' : 'fixed'"
                display-type="fixed-width" :hide-sort-tips="true">
                <template slot="sortIcon">
                  <t-icon name="caret-down-small"></t-icon>
                </template>
                <template #fir="{row}">
                  {{row.value}}
                </template>
                <template #price="{row}">
                  <!-- 新增线路的时候本地处理显示 -->
                  {{currency_prefix}}
                  <template v-if="lineType === 'add'">
                    {{calcPrice(row.price)}}
                  </template>
                  <template v-else>
                    {{(row.price*1).toFixed(2)}}
                    <template v-if="row.duration">/{{row.duration}}</template>
                  </template>
                  &nbsp;{{lang.rise}}
                </template>
                <template #op="{row, rowIndex}">
                  <div class="com-opt">
                    <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                      <t-icon name="edit-1" @click="editSubItem(row,rowIndex,'line_flow')"></t-icon>
                    </t-tooltip>
                    <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                      <t-icon name="delete" @click="comDel('line_flow',row, rowIndex)"></t-icon>
                    </t-tooltip>
                  </div>
                </template>
              </t-table>
              <p class="s-tip">{{lang.mf_tip21}}</p>
              <!-- 高级设置 -->
              <p class="advance_config" @click="bw_ip_show = !bw_ip_show">
                {{lang.advance_config}}
                <template>
                  <t-icon :name="bw_ip_show ? 'chevron-up' : 'chevron-down'"></t-icon>
                </template>
              </p>
              <div class="advance_box" v-show="bw_ip_show">
                <t-form-item :label="`IP${lang.group}`" label-align="top">
                  <t-input v-model="lineForm.bw_ip_group" :placeholder="lang.input"></t-input>
                </t-form-item>
              </div>
            </template>
            <!-- 公网IP价格配置 -->
            <div class="com-top">
              <p class="tit">
                {{lang.public_ip_config}}
              </p>
              <div class="add-btn gray" @click="addLineSub('line_ip')">
                {{lang.order_text53}}
              </div>
            </div>
            <t-table row-key="id" :data="lineForm.ip_data" size="medium" :columns="calcColums('ip')" :hover="hover"
              :loading="loading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
              :hide-sort-tips="true">
              <template slot="sortIcon">
                <t-icon name="caret-down-small"></t-icon>
              </template>
              <template #fir="{row}">
                <template v-if="lineType === 'add'">
                  {{calcIpNum(row.value)}}
                </template>
                <template v-else>
                  {{row.value}}
                </template>
              </template>
              <template #price="{row}">
                <!-- 新增线路的时候本地处理显示 -->
                {{currency_prefix}}
                <template v-if="lineType === 'add'">
                  {{calcPrice(row.price)}}
                </template>
                <template v-else>
                  {{(row.price*1).toFixed(2)}}
                  <template v-if="row.duration">/{{row.duration}}</template>
                </template>
                &nbsp;{{lang.rise}}
              </template>
              <template #op="{row,rowIndex}">
                <div class="com-opt">
                  <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                    <t-icon name="edit-1" @click="editSubItem(row,rowIndex,'line_ip')"></t-icon>
                  </t-tooltip>
                  <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                    <t-icon name="delete" @click="comDel('line_ip',row,rowIndex)"></t-icon>
                  </t-tooltip>
                </div>
              </template>
            </t-table>
            <!-- 防护价格配置 -->
            <div class="com-top">
              <p class="tit">
                <t-form-item :label="lang.protect_price_config">
                  <t-switch :custom-value="[1,0]" v-model="lineForm.defence_enable" size="small">
                  </t-switch>
                </t-form-item>
              </p>
              <div class="add-btn gray" @click="addLineSub('line_defence')" v-show="lineForm.defence_enable">
                {{lang.order_text53}}
              </div>
            </div>
            <t-table row-key="id" :data="lineForm.defence_data" size="medium" :columns="calcColums('defence')"
              :hover="hover" :loading="loading" :table-layout="tableLayout ? 'auto' : 'fixed'"
              display-type="fixed-width" :hide-sort-tips="true" v-show="lineForm.defence_enable">
              <template slot="sortIcon">
                <t-icon name="caret-down-small"></t-icon>
              </template>
              <template #fir="{row}">
                {{row.value}}
              </template>
              <template #price="{row}">
                <!-- 新增线路的时候本地处理显示 -->
                {{currency_prefix}}
                <template v-if="lineType === 'add'">
                  {{calcPrice(row.price)}}
                </template>
                <template v-else>
                  {{(row.price*1).toFixed(2)}}
                  <template v-if="row.duration">/{{row.duration}}</template>
                </template>
                &nbsp;{{lang.rise}}
              </template>
              <template #op="{row,rowIndex}">
                <div class="com-opt">
                  <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                    <t-icon name="edit-1" @click="editSubItem(row,rowIndex,'line_defence')"></t-icon>
                  </t-tooltip>
                  <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                    <t-icon name="delete" @click="comDel('line_defence',row,rowIndex)"></t-icon>
                  </t-tooltip>
                </div>
              </template>
            </t-table>
            <div v-show="lineForm.defence_enable">
              <p class="advance_config" @click="defence_ip_show = !defence_ip_show">
                {{lang.advance_config}}
                <template>
                  <t-icon :name="defence_ip_show ? 'chevron-up' : 'chevron-down'"></t-icon>
                </template>
              </p>
              <!-- 高级设置 -->
              <div class="advance_box" v-show="defence_ip_show">
                <t-form-item :label="`IP${lang.group}`" label-align="top">
                  <t-input v-model="lineForm.defence_ip_group" :placeholder="lang.input"></t-input>
                </t-form-item>
              </div>
            </div>

          </div>
          <!-- 右侧 -->
          <div class="c-item">
            <div class="empty" v-show="!lineRight">
              <p>{{lang.mf_tip12}}</p>
            </div>
            <!-- 新增、编辑线路子项 -->
            <div class="opt" v-if="lineRight">
              <t-form :data="subForm" ref="cycleForm" @submit="submitSub" :rules="calcRules" class="sub-form"
                label-align="top">
                <div class="scroll">
                  <!-- line_defence -->
                  <t-form-item :label="lang.defence + '（G）'" name="value" v-if="subType === 'line_defence'"
                    :rules="calcReg(lang.defence,0,999999)">
                    <t-input v-model="subForm.value" :placeholder="lang.input+lang.defence"></t-input>
                  </t-form-item>
                  <!-- line_flow -->
                  <t-form-item :label="lang.cloud_flow + '（GB）'" name="value" v-if="subType === 'line_flow'"
                    :rules="calcReg(lang.bw,0,999999)">
                    <t-input v-model="subForm.value" :placeholder="lang.input+lang.cloud_flow"></t-input>
                  </t-form-item>
                  <!-- line_ip -->
                  <t-form-item :label="`IP${lang.auth_num}（${lang.one}）`" name="value" ref="ip-item"
                    :rules="calcReg(`IP${lang.auth_num}`,0,10000, 'ip')" v-if="subType === 'line_ip'" class="ip-item">
                    <t-input v-model="subForm.value" :placeholder="`${lang.input}IP${lang.auth_num}`"
                      @change="changeBw($event,'ip-item')"></t-input>
                  </t-form-item>
                  <div class="bw-tip" :class="{suc: bwValidator}" v-if="subType === 'line_ip'"
                    :key="new Date().getTime()">
                    <span>*{{lang.mf_tip32}}</span>
                    <span>*{{lang.mf_tip31}}</span>
                  </div>
                  <!-- 配置方式 -->
                  <t-form-item :label="`${lang.billing_way}`" name="type" v-if="subType === 'line_bw'"
                    class="mem-congfig">
                    <t-select v-model="subForm.type" :placeholder="`${lang.select}${lang.billing_way}`"
                      :disabled="calcShow">
                      <t-option :key="item.value" :value="item.value" :label="item.label" v-for="item in configType">
                      </t-option>
                    </t-select>
                  </t-form-item>
                  <template v-if="subType === 'line_flow'">
                    <t-form-item class="line_flow bw-limit" :label="`${lang.bw_limit}（Mbps）`">
                      <t-form-item label="" name="other_config.out_bw" :label="lang.out" label-align="left"
                        class="limit" :rules="calcReg(lang.out_bw,0,30000)">
                        <t-input v-model="subForm.other_config.out_bw" :placeholder="lang.out_bw"></t-input>
                      </t-form-item>
                      <t-form-item label="" name="other_config.in_bw" :label="lang.in" label-align="left" class="limit"
                        :rules="calcReg(lang.in_bw,0,30000)">
                        <t-input v-model="subForm.other_config.in_bw" :placeholder="lang.in_bw"></t-input>
                      </t-form-item>
                    </t-form-item>
                  </template>
                  <!-- 内存/系统盘/数据盘 -->
                  <t-form-item :label="calcName(subType)" v-if="subType === 'line_bw'" class="required">
                    <div v-if="subForm.type === 'radio'" class="tip-item">
                      <t-form-item name="value" style="width: 100%;" class="no-lable"
                        :rules="calcReg(lang.bw,1,30000,'nc')" ref="bw-item">
                        <t-input v-model="subForm.value" :placeholder="lang.input+calcName(subType)"
                          @change="changeBw($event,'bw-item')"></t-input>
                      </t-form-item>
                      <span class="bw-tip" :class="{suc: bwValidator}">*{{lang.mf_tip31}}</span>
                    </div>

                    <t-form-item v-else class="mul-select">
                      <t-form-item label=" " name="min_value" :required-mark="false" :rules="calcReg(lang.bw,1,30000)">
                        <t-input v-model="subForm.min_value" :placeholder="lang.min_value" @blur="changeMin"></t-input>
                      </t-form-item>
                      <t-form-item label=" " name="max_value" :required-mark="false" :rules="calcReg(lang.bw,1,30000)">
                        <t-input v-model="subForm.max_value" :placeholder="lang.max_value" @blur="changeMax"></t-input>
                      </t-form-item>
                      <!-- <t-form-item label=" " name="step" :required-mark="false">
                        <t-input v-model="subForm.step" :placeholder="lang.min_step"
                          @blur="changeStep"></t-input>
                      </t-form-item> -->
                    </t-form-item>
                  </t-form-item>
                  <!-- 周期价格 -->
                  <t-form-item :label="lang.price">
                    <div class="price-box">
                      <div class="item" v-for="(item,index) in subForm.price" :key="item.id">
                        <p class="txt">{{item.name}}</p>
                        <p class="num">
                          <!-- 循环验证 -->
                          <t-form-item :name="`price[${index}].price`"
                            :ruels="[ item.price * 1 ? calcRules.price : {required: true} ]">
                            <t-input v-model="item.price" @blur="blurSubPrice($event,index)"
                              :placeholder="((subForm.type === 'step' || subForm.type === 'total') && subType === 'line_bw') ? lang.mf_tip26: lang.input+lang.money"></t-input>
                          </t-form-item>
                        </p>
                      </div>
                      <!-- 自动填充 -->
                      <div class="item">
                        <p class="txt"></p>
                        <p class="num"><t-button size="small" :disabled="isShowFill(subForm.price)"
                            @click="autoFill('subForm',subForm.price)">{{lang.autofill}}</t-button>
                        </p>
                      </div>
                    </div>
                  </t-form-item>
                  <!-- 流量 -->
                  <template v-if="subType === 'line_flow'">
                    <t-form-item :label="`${lang.billing_cycle}`" class="mem-congfig" name="other_config.bill_cycle">
                      <template slot="label">
                        <t-tooltip :content="lang.mf_tip28 + '\n' + lang.mf_tip29" :show-arrow="false" theme="light"
                          placement="top-left">
                          <span>{{lang.billing_cycle}}</span>
                          <t-icon name="help-circle"></t-icon>
                        </t-tooltip>
                      </template>
                      <t-select v-model="subForm.other_config.bill_cycle"
                        :placeholder="`${lang.select}${lang.billing_cycle}`">
                        <t-option :key="item.value" :value="item.value" :label="item.label"
                          v-for="item in billingCycle">
                        </t-option>
                      </t-select>
                    </t-form-item>
                  </template>

                  <p class="advance_config" v-if="subType === 'line_bw'" @click="changeAdvance">
                    {{lang.advance_config}}
                    <template>
                      <t-icon :name="isAdvance ? 'chevron-up' : 'chevron-down'"></t-icon>
                    </template>
                  </p>
                  <!-- 子项高级设置 -->
                  <div class="advance_box" v-show="isAdvance">
                    <template v-if="subType === 'line_bw'">
                      <t-form-item :label="lang.inflow_bw" label-align="top">
                        <t-input v-model="subForm.other_config.in_bw" :placeholder="lang.input"></t-input>
                      </t-form-item>
                    </template>
                    <!-- <template v-if="calcType === 'system_disk' || calcType === 'data_disk'">
                      <t-form-item :label="lang.advanced_bw" label-align="top">
                        <t-input v-model="calcForm.other_config.disk_type" :placeholder="lang.input"></t-input>
                      </t-form-item>
                    </template> -->
                  </div>
                </div>
                <div class="com-btn">
                  <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
                  </t-button>
                  <t-button theme="default" variant="base" @click="lineRight=false">{{lang.back}}</t-button>
                </div>
              </t-form>
            </div>
          </div>
        </div>
        <div class="bot-opt" :class="{'hide-opt': lineRight}">
          <div class="b-item">
            <div class="com-btn">
              <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
              </t-button>
              <t-button theme="default" variant="base" @click="closeData">{{lang.cancel}}</t-button>
            </div>
          </div>
        </div>
      </div>
    </t-form>
  </t-dialog>
  <!-- 新增/修改 配置限制 -->
  <t-dialog :header="comTitle" :visible.sync="limitModel" :footer="false" width="625" @close="closeData">
    <t-form :data="lineForm" ref="lineForm" @submit="submitLimit" :rules="dataRules" class="data-form limit-form"
      v-if="limitModel">
      <t-form-item :label="lang.data_center" class="required" v-if="limitType !== 'cpu'">
        <t-form-item name="country_id" :required-mark="false">
          <t-select v-model="lineForm.country_id" class="flow-type" :placeholder="lang.select+lang.country" filterable
            @change="changeCountry"
            :popup-props="{ overlayClassName: `custom-data`, overlayStyle: (trigger) => ({ width: `${trigger.offsetWidth}px` })}">
            <img class="s-icon" :class="{'noIcon': !dataForm.country_id && !lineForm.country_id }" slot="prefixIcon"
              :src="calcIcon1" />
            <t-option :key="item.id" :value="item.id" :label="item.name" v-for="item in countrySelect"
              class="custom-icon">
              <img :src="`${host}/upload/common/country/${item.iso}.png`" alt="" class="icon">
              {{item.name}}
            </t-option>
          </t-select>
        </t-form-item>
        <t-form-item label="" name="city" :required-mark="false">
          <t-select v-model="lineForm.city" class="flow-type" @change="changeCity" :placeholder="lang.select+lang.city">
            <t-option :key="c" :value="city.name" :label="city.name" v-for="(city, c) in calcCity">
            </t-option>
          </t-select>
        </t-form-item>
        <t-form-item label="" name="data_center_id" :required-mark="false">
          <t-select v-model="lineForm.data_center_id" class="flow-type" :placeholder="lang.select+lang.area">
            <t-option :key="area.id" :value="area.id" :label="area.name" v-for="area in calcArea">
            </t-option>
          </t-select>
        </t-form-item>
      </t-form-item>
      <!-- 型号 -->
      <t-form-item :label="lang.box_title46" name="model_config_id">
        <t-select v-model="lineForm.model_config_id" :placeholder="lang.select+lang.box_title46" multiple
          :min-collapsed-num="2">
          <t-option :key="area.id" :value="area.id" :label="area.name" v-for="area in modelList">
          </t-option>
        </t-select>
      </t-form-item>
      <!-- 线路 -->
      <t-form-item :label="lang.bw_line">
        <t-select v-model="lineForm.line_id" :placeholder="lang.select+lang.bw_line" @change="changeLine" clearable>
          <t-option :key="area.id" :value="area.id" :label="area.name" v-for="area in calcSelectLine">
          </t-option>
        </t-select>
      </t-form-item>
      <!-- 流量 -->
      <t-form-item :label="`${lang.cloud_flow}（GB）`" class="limit-bw"
        v-if="limitMemoryType && limitMemoryType === 'flow'">
        <t-form-item lable="" name="min_flow" :required-mark="false">
          <t-input v-model="lineForm.min_flow" :placeholder="lang.min_value"></t-input>
        </t-form-item>
        <t-form-item lable="" name="max_flow" :required-mark="false">
          <t-input v-model="lineForm.max_flow" :placeholder="lang.max_value"></t-input>
        </t-form-item>
      </t-form-item>
      <!-- 带宽 -->
      <t-form-item :label="`${lang.bw}（Mbps）`" class="limit-bw" v-if="limitMemoryType && limitMemoryType === 'bw'">
        <t-form-item lable="" name="min_bw" :required-mark="false"
          :rules="(lineForm.min_bw || lineForm.max_bw) ? dataRules.min_bw : [{}]">
          <t-input v-model="lineForm.min_bw" :placeholder="lang.min_value"></t-input>
        </t-form-item>
        <t-form-item lable="" name="max_bw" :required-mark="false"
          :rules="(lineForm.min_bw || lineForm.max_bw) ? dataRules.max_bw : [{}]">
          <t-input v-model="lineForm.max_bw" :placeholder="lang.max_value"></t-input>
        </t-form-item>
      </t-form-item>
      <div class="com-f-btn">
        <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
        </t-button>
        <t-button theme="default" variant="base" @click="limitModel = false">{{lang.cancel}}</t-button>
      </div>
    </t-form>
  </t-dialog>
  <!-- 删除提示框 -->
  <t-dialog theme="warning" :header="delTit" :close-btn="false" :visible.sync="delVisible" class="deleteDialog">
    <p class="des" v-if="delType==='cycle'">{{lang.delete_tip}}</p>
    <template slot="footer">
      <t-button theme="primary" @click="sureDelete">{{lang.sure}}</t-button>
      <t-button theme="default" @click="delVisible=false">{{lang.cancel}}</t-button>
    </template>
  </t-dialog>
</div>
<script src="/plugins/server/mf_dcim/template/admin/api/mf_dcim.js"></script>

<script src="/plugins/server/mf_dcim/template/admin/js/mf_dcim.js"></script>
